# ุนุฑุถ ุงูุฌูุณุงุช ูู ุตูุญุฉ ุงูููุงุชูุฑ

## ูุธุฑุฉ ุนุงูุฉ

ุงูุฌูุณุงุช (Sessions) ุชุธูุฑ ูู ุตูุญุฉ ุงูููุงุชูุฑ ุจุทุฑููุชูู ูุฎุชููุชูู ุญุณุจ ุงุฑุชุจุงุทูุง ุจุทุงููุฉ:

## 1. ุงูุฌูุณุงุช ุบูุฑ ุงููุฑุชุจุทุฉ ุจุทุงููุฉ

### ุงูุนุฑุถ:
- ุชุธูุฑ ูู ูุณู **"ุฃุฌูุฒุฉ ุงูุจูุงูุณุชูุดู"**
- ุชูุฌูุน ุญุณุจ ุงุณู ุงูุฌูุงุฒ (deviceName)
- ุชุธูุฑ ุชุญุช ุงุณู ุงูุฌูุงุฒ ูุน ุนูุงูุฉ "โ๏ธ ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ"

### ูุชู ุชุธูุฑ:
- โ ุนูุฏ ุฅูุดุงุก ุงูุฌูุณุฉ (ุญุงูุฉ: active)
- โ ุจุนุฏ ุงูุชูุงุก ุงูุฌูุณุฉ (ุญุงูุฉ: completed)
- โ ุญุชู ุจุนุฏ ุญุฐู ุงููุงุชูุฑุฉ (ุงูุฌูุณุฉ ุชุจูู ูุณุฌู ุชุงุฑูุฎู)

### ูุซุงู:
```
๐ฑ ุฃุฌูุฒุฉ ุงูุจูุงูุณุชูุดู
  โโ ๐ฎ PS5 - 1
      โโ ูุงุชูุฑุฉ #B-001 โ๏ธ ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ ๐ค ุฃุญูุฏ
      โโ ูุงุชูุฑุฉ #B-002 โ๏ธ ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ ๐ค ูุญูุฏ
```

## 2. ุงูุฌูุณุงุช ุงููุฑุชุจุทุฉ ุจุทุงููุฉ

### ุงูุนุฑุถ:
- ุชุธูุฑ **ุฏุงุฎู ูุงุชูุฑุฉ ุงูุทุงููุฉ**
- ูู ูุณู ุงูุทุงููุงุช
- ูุน ูุนูููุงุช ุงูุทุงููุฉ (ุฑูู ุงูุทุงููุฉุ ุงููุณู)

### ูุชู ุชุธูุฑ:
- โ ุนูุฏ ุฅูุดุงุก ุงูุฌูุณุฉ (ุญุงูุฉ: active)
- โ ุจุนุฏ ุงูุชูุงุก ุงูุฌูุณุฉ (ุญุงูุฉ: completed)
- โ ุญุชู ุจุนุฏ ุญุฐู ุงููุงุชูุฑุฉ (ุงูุฌูุณุฉ ุชุจูู)

### ูุซุงู:
```
๐ช ุงูุทุงููุงุช
  โโ ุทุงููุฉ 5
      โโ ูุงุชูุฑุฉ #B-003
          โโ ุทูุจุงุช ุงููุงููู
          โโ ุฌูุณุฉ PS5 - 2 (ููุชููุฉ)
```

## ุงูููุชุฑุฉ

### ููุชุฑ ุงูุญุงูุฉ ูู ูุณู ุงูุจูุงูุณุชูุดู:
- **ุบูุฑ ูุฏููุน**: ูุนุฑุถ ุงูููุงุชูุฑ ุฐุงุช ุงูุญุงูุฉ draft, partial, overdue
- **ูุฏููุน**: ูุนุฑุถ ุงูููุงุชูุฑ ุงููุฏููุนุฉ ุจุงููุงูู
- **ุงููู**: ูุนุฑุถ ุฌููุน ุงูููุงุชูุฑ

### ููุงุญุธุฉ ูููุฉ:
ุงูุฌูุณุงุช ุงูููุชููุฉ ุชุธูุฑ **ุฏุงุฆูุงู** ุทุงููุง ุฃู ุงููุงุชูุฑุฉ ููุฌูุฏุฉุ ุจุบุถ ุงููุธุฑ ุนู ุญุงูุฉ ุงูุฌูุณุฉ (active/completed).

## ุณููู ุงูุญุฐู

### ุนูุฏ ุญุฐู ูุงุชูุฑุฉ ุชุญุชูู ุนูู ุฌูุณุฉ:

1. **ุงููุงุชูุฑุฉ**: ุชูุญุฐู ูู Local ู Atlas
2. **ุงูุฌูุณุฉ**: ุชุจูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ููู ูุชู ุฅุฒุงูุฉ `bill` reference
3. **ุงูุนุฑุถ**: ุงูุฌูุณุฉ ูู ุชุธูุฑ ูู ุตูุญุฉ ุงูููุงุชูุฑ (ูุฃููุง ูู ุชุนุฏ ูุฑุชุจุทุฉ ุจูุงุชูุฑุฉ)
4. **ุงูุชูุงุฑูุฑ**: ุงูุฌูุณุฉ ุชุจูู ูุชุงุญุฉ ูู ุงูุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช

## ุงูููุฏ ุงููุณุคูู ุนู ุงูุนุฑุถ

### ูู `src/pages/Billing.tsx`:

```typescript
// ุชุฌููุน ุฌููุน ุงูููุงุชูุฑ ุงูุชู ุชุญุชูู ุนูู ุฌูุณุงุช ุจูุงูุณุชูุดู
const allPlaystationBills = bills.filter((bill: Bill) => 
  bill.billType === 'playstation' || 
  (bill.sessions && bill.sessions.some((s: any) => s.deviceType === 'playstation'))
);

// ุชุฌููุน ุงูุฃุฌูุฒุฉ ุญุณุจ ุงูุงุณู
allPlaystationBills.forEach((bill: Bill) => {
  const playstationSessions = bill.sessions?.filter((s: any) => 
    s.deviceType === 'playstation'
  ) || [];
  
  playstationSessions.forEach((session: any) => {
    const deviceKey = session.deviceName || `ุฌูุงุฒ ${session.deviceNumber}`;
    const isLinkedToTable = !!bill.table;
    
    // ุฅุฐุง ูู ุชูู ูุฑุชุจุทุฉ ุจุทุงููุฉุ ุฃุถููุง ููุงุฆูุฉ ุงูุฌูุงุฒ
    if (!isLinkedToTable) {
      deviceData.bills.push(bill);
    }
  });
});
```

## Console Logs ููุชุชุจุน

ุนูุฏ ูุชุญ ุตูุญุฉ ุงูููุงุชูุฑุ ุณุชุฌุฏ ูู Console:

```
๐ฎ ุฅุฌูุงูู ููุงุชูุฑ ุงูุจูุงูุณุชูุดู: 5
๐ฎ ููุงุชูุฑ ุจูุงูุณุชูุดู ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ: 3
โ ุฅุถุงูุฉ ูุงุชูุฑุฉ ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ ููุฌูุงุฒ PS5-1: { billId: "...", status: "partial" }
๐ ุงูุฌูุงุฒ PS5-1: { totalBills: 2, unlinkedBills: 2, hasActiveSession: true }
๐ ููุงุชูุฑ ุบูุฑ ูุฑุชุจุทุฉ ุจุทุงููุฉ (ูุงููู ููุท): 1
```

## ุฃุณุฆูุฉ ุดุงุฆุนุฉ

### ุณ: ููุงุฐุง ูุง ุชุธูุฑ ุงูุฌูุณุฉ ุงูููุชููุฉุ
**ุฌ**: ุชุญูู ูู:
1. ุงููุงุชูุฑุฉ ููุฌูุฏุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุงูุฌูุณุฉ ูุฑุชุจุทุฉ ุจุงููุงุชูุฑุฉ (`session.bill` ูุดูุฑ ูููุงุชูุฑุฉ)
3. ุงูููุชุฑ ุงููุฎุชุงุฑ ูุณูุญ ุจุนุฑุถ ุญุงูุฉ ุงููุงุชูุฑุฉ
4. ุงูุฌูุงุฒ ุบูุฑ ูุทูู (collapsed)

### ุณ: ูู ุงูุฌูุณุงุช ุงููุญุฐููุฉ ุชุธูุฑุ
**ุฌ**: ูุงุ ุงูุฌูุณุงุช ุงููุญุฐููุฉ ูุง ุชุธูุฑ. ููู ุนูุฏ ุญุฐู ูุงุชูุฑุฉุ ุงูุฌูุณุงุช **ูุง ุชูุญุฐู** - ููุท ูุชู ุฅุฒุงูุฉ ูุฑุฌุน ุงููุงุชูุฑุฉ ูููุง.

### ุณ: ููู ุฃุฑู ุฌููุน ุงูุฌูุณุงุช (ุญุชู ุจุฏูู ููุงุชูุฑ)ุ
**ุฌ**: ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุจูุงูุณุชูุดู ุฃู ุงูููุจููุชุฑ - ููุงู ุณุชุฌุฏ ุฌููุน ุงูุฌูุณุงุช ุจูุง ูููุง ุงูุชู ููุณ ููุง ููุงุชูุฑ.

### ุณ: ููุงุฐุง ุชุจูู ุงูุฌูุณุงุช ุจุนุฏ ุญุฐู ุงููุงุชูุฑุฉุ
**ุฌ**: ุงูุฌูุณุงุช ุณุฌู ุชุงุฑูุฎู ููู ููุชูุงุฑูุฑ ูุงูุฅุญุตุงุฆูุงุช (ูุซู: ุฅุฌูุงูู ุณุงุนุงุช ุงููุนุจุ ุงูุฅูุฑุงุฏุงุชุ ุฃููุงุช ุงูุฐุฑูุฉุ ุฅูุฎ).

## ุงููููุงุช ุฐุงุช ุงูุตูุฉ

- `src/pages/Billing.tsx` - ุตูุญุฉ ุงูููุงุชูุฑ
- `server/controllers/billingController.js` - ููุทู ุงูููุงุชูุฑ ูู ุงูุจุงููุฏ
- `server/models/Bill.js` - ูููุฐุฌ ุงููุงุชูุฑุฉ
- `server/models/Session.js` - ูููุฐุฌ ุงูุฌูุณุฉ
