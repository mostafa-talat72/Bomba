# ุฅุตูุงุญ ูุทุงุจูุฉ ุงูุฃุณูุงุก ูู ูุธุงู ุงูุฏูุน ุงูุฌุฒุฆู

## ุงูุชุงุฑูุฎ
2024-11-24

## ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุงูุฏูุน ุงูุฌุฒุฆู ููุฃุตูุงูุ ูุฏ ุชุธูุฑ ุฑุณุงูุฉ "ูู ูุชู ุงูุนุซูุฑ ุนูู ุนูุงุตุฑ ุตุงูุญุฉ ููุฏูุน" ุจุงูุฑุบู ูู ูุฌูุฏ ุนูุงุตุฑ ุบูุฑ ูุฏููุนุฉ.

## ุงูุณุจุจ ุงููุญุชูู
ุงููุดููุฉ ูุฏ ุชููู ุจุณุจุจ ุนุฏู ุชุทุงุจู ุงูุฃุณูุงุก ุจูู:
- `item.itemName` ูู ูุงุฆูุฉ ุงูุนูุงุตุฑ ุงููุทููุจ ุฏูุนูุง (`itemsToPay`)
- `payment.itemName` ูู ูุงุฆูุฉ `itemPayments` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ุงูุฃุณุจุงุจ ุงููุญุชููุฉ ูุนุฏู ุงูุชุทุงุจู:
1. ูุณุงูุงุช ุฒุงุฆุฏุฉ ูู ุจุฏุงูุฉ ุฃู ููุงูุฉ ุงูุงุณู
2. ูุณุงูุงุช ูุฒุฏูุฌุฉ ูู ููุชุตู ุงูุงุณู
3. ุฃุญุฑู ุบูุฑ ูุฑุฆูุฉ (zero-width spaces, etc.)
4. ุงุฎุชูุงูุงุช ูู ุชุฑููุฒ ุงูุฃุญุฑู ุงูุนุฑุจูุฉ

## ุงูุฅุตูุงุญ

### 1. ุชุญุณูู ุงููุทุงุจูุฉ ูู Frontend (Billing.tsx)

ุชู ุชุญุฏูุซ ููุทู ุงููุทุงุจูุฉ ูุชูุธูู ุงูุฃุณูุงุก ูุจู ุงูููุงุฑูุฉ:

```typescript
// ูุจู ุงูุฅุตูุงุญ
const nameMatch = payment.itemName === item.itemName;

// ุจุนุฏ ุงูุฅุตูุงุญ
const itemNameTrimmed = item.itemName.trim();
const paymentNameTrimmed = payment.itemName.trim();
const nameMatch = paymentNameTrimmed === itemNameTrimmed;
```

### 2. ุฅุถุงูุฉ ุชุดุฎูุต ููุตู

ุชู ุฅุถุงูุฉ console.log ููุตู ูุชุดุฎูุต ุงููุดููุฉ:

```typescript
  item.itemName.split('').map((c: string) => c.charCodeAt(0)));

if (!nameMatch) {
  
}
```

ูุฐุง ุงูุชุดุฎูุต ูุณุงุนุฏ ูู:
- ูุนุฑูุฉ ุทูู ูู ุงุณู
- ุฑุคูุฉ ุงูุฃุญุฑู ุงููุนููุฉ (character codes) ููู ุงุณู
- ุงูุชุดุงู ุงููุณุงูุงุช ุงูุฒุงุฆุฏุฉ ุฃู ุงูุฃุญุฑู ุบูุฑ ุงููุฑุฆูุฉ

### 3. ุชุญุฏูุซ ุฏุงูุฉ calculatePaidQuantity (billAggregation.ts)

ุชู ุชุทุจูู ููุณ ุงูููุทู ูู ุฏุงูุฉ ุญุณุงุจ ุงููููุงุช ุงููุฏููุนุฉ:

```typescript
const itemNameTrimmed = itemName.trim();
const paymentNameTrimmed = payment.itemName.trim();
const nameMatch = paymentNameTrimmed === itemNameTrimmed;
```

## ููููุฉ ุงูุชุดุฎูุต

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงูุชุญ console ูู ุงููุชุตูุญ ูุงุจุญุซ ุนู:

1. **ุฑุณุงุฆู ุงูุจุญุซ**: `๐ Searching for:`
   - ุชุนุฑุถ ุงูุงุณู ุงููุทููุจ ุฏูุนู

2. **ุฑุณุงุฆู ุงููุทุงุจูุฉ**: `Checking payment:`
   - ุชุนุฑุถ ูู `itemPayment` ูุชู ูุญุตู
   - ุชุนุฑุถ ูุชูุฌุฉ ุงููุทุงุจูุฉ (nameMatch, priceMatch, etc.)

3. **ุฑุณุงุฆู ุนุฏู ุงูุชุทุงุจู**: `โ Name mismatch:`
   - ุชุธูุฑ ููุท ุนูุฏูุง ูุง ุชุชุทุงุจู ุงูุฃุณูุงุก
   - ุชุนุฑุถ ุงูุฃุณูุงุก ูุฃุทูุงููุง ูcharacter codes

4. **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**: `๐ Final itemPaymentIds:`
   - ุชุนุฑุถ ูุงุฆูุฉ IDs ุงูุชู ุณูุชู ุฅุฑุณุงููุง ููู backend

## ูุซุงู ุนูู ุงูุชุดุฎูุต

```
๐ Searching for: "ุดุงู ูุชูู" @ 10 EGP, qty: 2
  Item name length: 8, charCodes: [1588, 1575, 1609, 32, 1601, 1578, 1604, 1607]
  
  Checking payment: "ุดุงู ูุชูู" x4
    nameMatch: true
    priceMatch: true
    notPaid: true
    hasRemaining: true
    willAdd: true
  โ Adding payment ID: 692122c3fca149529c1a93e0
```

## ุงููููุงุช ุงููุนุฏูุฉ

1. **src/pages/Billing.tsx**
   - ุชุญุฏูุซ ููุทู ุงููุทุงุจูุฉ ูู `handlePartialPaymentSubmit`
   - ุฅุถุงูุฉ ุชุดุฎูุต ููุตู

2. **src/utils/billAggregation.ts**
   - ุชุญุฏูุซ ููุทู ุงููุทุงุจูุฉ ูู `calculatePaidQuantity`

## ุงูุฎุทูุงุช ุงูุชุงููุฉ

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ูุฐุง ุงูุฅุตูุงุญ:

1. ุงูุชุญ console ูู ุงููุชุตูุญ
2. ุญุงูู ุงูุฏูุน ุงูุฌุฒุฆู
3. ุงูุณุฎ ุฑุณุงุฆู console ุงููุงููุฉ
4. ุงุจุญุซ ุนู ุฑุณุงุฆู `โ Name mismatch`
5. ูุงุฑู character codes ููุฃุณูุงุก ุบูุฑ ุงููุชุทุงุจูุฉ

## ููุงุญุธุงุช

- ุฏุงูุฉ `trim()` ุชุฒูู ุงููุณุงูุงุช ูู ุงูุจุฏุงูุฉ ูุงูููุงูุฉ ููุท
- ุฅุฐุง ูุงูุช ุงููุดููุฉ ูู ูุณุงูุงุช ูุฒุฏูุฌุฉ ูู ุงูููุชุตูุ ูุฏ ูุญุชุงุฌ ุฅูู:
  ```typescript
  const normalize = (str: string) => str.trim().replace(/\s+/g, ' ');
  ```

- ุฅุฐุง ูุงูุช ุงููุดููุฉ ูู ุชุฑููุฒ ุงูุฃุญุฑู ุงูุนุฑุจูุฉุ ูุฏ ูุญุชุงุฌ ุฅูู normalization:
  ```typescript
  const normalize = (str: string) => str.trim().normalize('NFC');
  ```

## ุงูุงุฎุชุจุงุฑ

ูุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ:

1. ุงูุชุญ ุตูุญุฉ Billing
2. ุงุฎุชุฑ ูุงุชูุฑุฉ ุจูุง ุนูุงุตุฑ ุบูุฑ ูุฏููุนุฉ
3. ุงุถุบุท "ุฏูุน ุฌุฒุฆู ููุฃุตูุงู"
4. ุงุฎุชุฑ ุนูุตุฑ ูุญุฏุฏ ุงููููุฉ
5. ุงุถุบุท "ุชุฃููุฏ ุงูุฏูุน"
6. ุชุญูู ูู console ููุชุฃูุฏ ูู:
   - ุชู ุงูุนุซูุฑ ุนูู itemPaymentIds
   - ุชู ุงูุฏูุน ุจูุฌุงุญ
   - ุชู ุชุญุฏูุซ ุงููุงุชูุฑุฉ

## ุงููุชูุฌุฉ ุงููุชููุนุฉ

โ ูุฌุจ ุฃู ูุนูู ุงูุฏูุน ุงูุฌุฒุฆู ุจุดูู ุตุญูุญ ุญุชู ูู ูุงูุช ููุงู ูุณุงูุงุช ุฒุงุฆุฏุฉ ูู ุงูุฃุณูุงุก
โ ุฑุณุงุฆู console ุงูููุตูุฉ ุชุณุงุนุฏ ูู ุชุดุฎูุต ุฃู ูุดุงูู ูุชุจููุฉ
โ ุงูููุทู ููุญุฏ ุจูู Frontend (Billing.tsx) ู Utility (billAggregation.ts)
