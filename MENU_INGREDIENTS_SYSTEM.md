# نظام الخامات المرتبطة بعناصر المنيو

## نظرة عامة
تم إضافة نظام جديد يسمح بربط عناصر المنيو بالخامات (المخزون) المرتبطة بها. هذا النظام مفيد لتتبع الخامات المستخدمة في كل عنصر من عناصر القائمة.

## الميزات المضافة

### 1. حقل الخامات في نموذج MenuItem
- تم إضافة حقل `ingredients` إلى مخطط MenuItem في الباكند
- هذا الحقل عبارة عن مصفوفة من الكائنات، كل كائن يحتوي على:
  - `item`: معرف العنصر من المخزون (ObjectId)
  - `quantity`: الكمية المطلوبة من هذا الخام
  - `unit`: وحدة القياس (جرام، كيلو، مل، لتر، قطعة، ملعقة، كوب)

### 2. واجهة المستخدم المحسنة
- تم إضافة قسم "الخامات المرتبطة" في نافذة إضافة/تعديل عنصر المنيو
- إمكانية إضافة خامات متعددة لكل عنصر
- اختيار الخامة من قائمة المخزون (الخامات فقط)
- تحديد الكمية والوحدة لكل خامة
- إمكانية حذف الخامات المضافة

### 3. عرض الخامات في قائمة المنيو
- يتم عرض الخامات المرتبطة بكل عنصر في بطاقة العنصر
- عرض مختصر للكميات والوحدات

## كيفية الاستخدام

### إضافة خامات لعنصر جديد
1. اذهب إلى صفحة "إدارة المنيو"
2. اضغط على "إضافة عنصر"
3. املأ البيانات الأساسية (الاسم، السعر، الفئة، إلخ)
4. في قسم "الخامات المرتبطة":
   - اضغط على "إضافة خامة مرتبطة"
   - اختر الخامة من القائمة المنسدلة
   - أدخل الكمية المطلوبة
   - اختر وحدة القياس
   - كرر العملية لإضافة خامات أخرى
5. اضغط على "إضافة العنصر"

### تعديل خامات عنصر موجود
1. اذهب إلى صفحة "إدارة المنيو"
2. اضغط على أيقونة التعديل للعنصر المطلوب
3. عدل الخامات المرتبطة كما هو مطلوب
4. اضغط على "تحديث العنصر"

## الملفات المعدلة

### الباكند
- `server/models/MenuItem.js`: إضافة حقل `ingredients`
- `server/controllers/menuController.js`: يدعم الخامات تلقائياً (لا يحتاج تعديل)

### الفرونت
- `src/services/api.ts`: إضافة حقل `ingredients` إلى واجهة MenuItem
- `src/pages/Menu.tsx`: إضافة واجهة إدارة الخامات

## مثال على الاستخدام

### عنصر "قهوة تركية"
```json
{
  "name": "قهوة تركية",
  "price": 15,
  "category": "مشروبات ساخنة",
  "ingredients": [
    {
      "item": "64f8a1b2c3d4e5f6a7b8c9d0", // معرف البن
      "quantity": 10,
      "unit": "جرام"
    },
    {
      "item": "64f8a1b2c3d4e5f6a7b8c9d1", // معرف السكر
      "quantity": 5,
      "unit": "جرام"
    }
  ]
}
```

## الفوائد
1. **تتبع المخزون**: معرفة الخامات المستخدمة في كل عنصر
2. **إدارة التكلفة**: حساب تكلفة الخامات لكل عنصر
3. **التخطيط**: معرفة الكميات المطلوبة من كل خامة
4. **المرونة**: إمكانية تعديل الخامات بسهولة

## ملاحظات تقنية
- يتم عرض الخامات من المخزون التي لها `isRawMaterial: true` فقط
- يمكن إضافة خامات متعددة لكل عنصر
- يمكن حذف الخامات أو تعديلها في أي وقت
- البيانات محفوظة في قاعدة البيانات ومرتبطة بالمنشأة
