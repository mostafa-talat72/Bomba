# ุฅุตูุงุญ ูุดููุฉ ุชุญููู ุงูุจูุงูุงุช ููููุธู

## ๐จ ุงููุดููุฉ
ุนูุฏ ุชุณุฌูู ุฏุฎูู ุงูููุธู ูุจุงุดุฑุฉุ ูุง ุชุธูุฑ ุงูุจูุงูุงุช ูู ุตูุญุงุช ุงูุทูุจุงุช ูุงูููุงุชูุฑ. ุงูุจูุงูุงุช ุชุธูุฑ ููุท ุจุนุฏ:
1. ุชุณุฌูู ุฎุฑูุฌ ุงูููุธู
2. ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ
3. ุชุณุฌูู ุฎุฑูุฌ ุงููุฏูุฑ
4. ุชุณุฌูู ุฏุฎูู ุงูููุธู ูุฑุฉ ุฃุฎุฑู

## ๐ ุงูุณุจุจ
ุงููุดููุฉ ุชููู ูู ุฏูุงู ุฌูุจ ุงูุจูุงูุงุช ูู `AppContext.tsx`:
1. **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุงูุตุงูุชุฉ**: ุนูุฏ ูุดู ุฌูุจ ุงูุจูุงูุงุชุ ูุง ูุชู ุชุณุฌูู ุงูุฎุทุฃ ุฃู ุฅุนุงุฏุฉ ุงููุญุงููุฉ
2. **ุนุฏู ุชููุฆุฉ ุงูุจูุงูุงุช**: ุฅุฐุง ูุดู ุงูุทูุจุ ุชุจูู ุงูุจูุงูุงุช `undefined` ุจุฏูุงู ูู ูุตูููุฉ ูุงุฑุบุฉ
3. **ุนุฏู ูุฌูุฏ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ**: ูุง ุชูุฌุฏ ุขููุฉ ูุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช ุนูุฏ ุงููุดู

## โ ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `fetchOrders`
```typescript
const fetchOrders = async (): Promise<void> => {
  // Skip if not authenticated or logging out
  if (!isAuthenticated || isLoggingOut) return;
  
  try {
    const response = await api.getOrders();
    if (response.success && response.data) {
      // ูุนุงูุฌุฉ ุงูุจูุงูุงุช...
      setOrders(filteredOrders);
    } else {
      // โ ุชุฃูุฏ ูู ุฃู ุงููุงุฆูุฉ ูุงุฑุบุฉ ุจุฏูุงู ูู undefined
      setOrders([]);
    }
  } catch (error) {
    if (isAuthenticated && !isLoggingOut) {
      console.warn('Failed to fetch orders:', error);
      // โ ุชุฃูุฏ ูู ุฃู ุงููุงุฆูุฉ ูุงุฑุบุฉ ุจุฏูุงู ูู undefined
      setOrders([]);
    }
  }
};
```

### 2. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูู `fetchBills`
```typescript
const fetchBills = async (): Promise<void> => {
  // Skip if not authenticated or logging out
  if (!isAuthenticated || isLoggingOut) return;
  
  try {
    const response = await api.getBills();
    if (response.success && response.data) {
      setBills(response.data);
    } else {
      // โ ุชุฃูุฏ ูู ุฃู ุงููุงุฆูุฉ ูุงุฑุบุฉ ุจุฏูุงู ูู undefined
      setBills([]);
    }
  } catch (error) {
    if (isAuthenticated && !isLoggingOut) {
      console.warn('Failed to fetch bills:', error);
      // โ ุชุฃูุฏ ูู ุฃู ุงููุงุฆูุฉ ูุงุฑุบุฉ ุจุฏูุงู ูู undefined
      setBills([]);
    }
  }
};
```

### 3. ุฅุถุงูุฉ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูู `refreshData`
```typescript
const refreshData = async (retryCount = 0): Promise<void> => {
  if (!isAuthenticated && !user) {
    return;
  }

  try {
    // ุฌูุจ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุฃููุงู
    await Promise.all([
      fetchOrders(),
      fetchBills(),
      fetchSessions(),
      // ... ุจุงูู ุงูุจูุงูุงุช
    ]);
  } catch (error) {
    console.warn('Error in refreshData:', error);
    
    // โ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ูุฑุฉ ูุงุญุฏุฉ ุจุนุฏ ุชุฃุฎูุฑ ูุตูุฑ
    if (retryCount < 1 && isAuthenticated && !isLoggingOut) {
      console.log('Retrying data fetch...');
      setTimeout(() => {
        refreshData(retryCount + 1);
      }, 1000);
    }
  }
};
```

### 4. ุฅุถุงูุฉ ุฏุงูุฉ `forceRefreshData` ูุฅุนุงุฏุฉ ุงูุชุญููู ุงููุฏูู
```typescript
const forceRefreshData = async (): Promise<void> => {
  if (!isAuthenticated || !user) {
    return;
  }

  console.log('Force refreshing data for user:', user.role);
  
  // โ ุฅุนุงุฏุฉ ุชุนููู ุงูุจูุงูุงุช ุฃููุงู
  setOrders([]);
  setBills([]);
  setSessions([]);
  
  // ุซู ุฌูุจ ุงูุจูุงูุงุช ูุฑุฉ ุฃุฎุฑู
  await refreshData(0);
};
```

### 5. ุชุญุฏูุซ ุงูู Interface ูุงูู Context
```typescript
interface AppContextType {
  // ... ุจุงูู ุงูุฎุตุงุฆุต
  refreshData: () => Promise<void>;
  forceRefreshData: () => Promise<void>; // โ ุฏุงูุฉ ุฌุฏูุฏุฉ
}

const value: AppContextType = {
  // ... ุจุงูู ุงูููู
  refreshData,
  forceRefreshData, // โ ุฅุถุงูุฉ ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ
};
```

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ููู ุงูุงุฎุชุจุงุฑ:
`test-staff-data-loading.html`

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. **ุชุณุฌูู ุฏุฎูู ุงูููุธู**:
   - ุงูุจุฑูุฏ: `staff@bomba.com`
   - ูููุฉ ุงููุฑูุฑ: `staff123`

2. **ูุญุต ุงูุจูุงูุงุช ุงููุญููุฉ**:
   - ุงุถุบุท "ูุญุต ุงูุจูุงูุงุช ุงูุญุงููุฉ"
   - ูุฌุจ ุฃู ุชุธูุฑ ุนุฏุฏ ุงูุนูุงุตุฑ ููู ููุน ุจูุงูุงุช

3. **ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช**:
   - ุงุถุบุท "ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช" ุฅุฐุง ูู ุชุธูุฑ ุงูุจูุงูุงุช

4. **ููุงุฑูุฉ ูุน ุงููุฏูุฑ**:
   - ุณุฌู ุฏุฎูู ุงููุฏูุฑ
   - ุงุถุบุท "ููุงุฑูุฉ ุงูุจูุงูุงุช ุจูู ุงูููุธู ูุงููุฏูุฑ"
   - ูุฌุจ ุฃู ุชููู ุงูุจูุงูุงุช ูุชุทุงุจูุฉ

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุงูุจูุงูุงุช ุชุธูุฑ ููููุธู ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู ูุจุงุดุฑุฉ
- โ ูุนุงูุฌุฉ ุฃูุถู ููุฃุฎุทุงุก ูุน ุชุณุฌูู ูุงุถุญ
- โ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ ุนูุฏ ูุดู ุงูุชุญููู
- โ ุฏุงูุฉ ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุฏูู ููุญุงูุงุช ุงูุทุงุฑุฆุฉ
- โ ุงูุจูุงูุงุช ูุชุทุงุจูุฉ ุจูู ุงููุฏูุฑ ูุงูููุธู

### ๐ง ุขููุฉ ุงูุนูู ุงูุฌุฏูุฏุฉ:
1. **ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู**: ูุชู ุงุณุชุฏุนุงุก `refreshData()`
2. **ุนูุฏ ูุดู ุงูุชุญููู**: ูุชู ุชุณุฌูู ุงูุฎุทุฃ ูุฅุนุงุฏุฉ ุงููุญุงููุฉ
3. **ุนูุฏ ุงููุดู ุงููุชูุฑุฑ**: ูุชู ุชุนููู ูุตูููุงุช ูุงุฑุบุฉ ุจุฏูุงู ูู `undefined`
4. **ููุฅุตูุงุญ ุงููุฏูู**: ูููู ุงุณุชุฏุนุงุก `forceRefreshData()`

## ๐ ุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ

### ูู ุฃู ูููู React:
```typescript
import { useApp } from '../context/AppContext';

const MyComponent = () => {
  const { forceRefreshData } = useApp();
  
  const handleRefresh = async () => {
    await forceRefreshData();
  };
  
  return (
    <button onClick={handleRefresh}>
      ุฅุนุงุฏุฉ ุชุญููู ุงูุจูุงูุงุช
    </button>
  );
};
```

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ูุดููุฉ ุชุญููู ุงูุจูุงูุงุช ููููุธู ุจูุฌุงุญ:
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุญุณูุฉ ูุน ุชุณุฌูู ูุงุถุญ
- โ ุขููุฉ ุฅุนุงุฏุฉ ุงููุญุงููุฉ ุงูุชููุงุฆูุฉ
- โ ุฏุงูุฉ ุฅุนุงุฏุฉ ุงูุชุญููู ุงููุฏูู
- โ ุชููุฆุฉ ุตุญูุญุฉ ููุจูุงูุงุช ุนูุฏ ุงููุดู
- โ ุงุฎุชุจุงุฑ ุดุงูู ููุชุญูู ูู ุงูุฅุตูุงุญ

ุงูุขู ูููู ููููุธู ุฑุคูุฉ ุงูุจูุงูุงุช ููุฑ ุชุณุฌูู ุงูุฏุฎูู ุจุฏูู ุงูุญุงุฌุฉ ูุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ ุฃููุงู.