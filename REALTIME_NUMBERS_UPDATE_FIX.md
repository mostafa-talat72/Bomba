# ุฅุตูุงุญ ุงูุชุญุฏูุซ ุงูููุฑู ููุฃุฑูุงู ูู ูุธุงู ุงูุฏูุน ุงูุฌุฒุฆู

## ุงููุดููุฉ ุงูุฃุณุงุณูุฉ
ุงูุฃุฑูุงู (ุงููููุงุช ุงููุฏููุนุฉ ูุงููุชุจููุฉ) ูุง ุชุชุญุฏุซ ููุฑุงู ุจุนุฏ ุชุฃููุฏ ุงูุฏูุน ุงูุฌุฒุฆู ูู:
1. **ูุงูุฐุฉ ุฏูุน ูุดุฑูุจุงุช ูุญุฏุฏุฉ** (PartialPaymentModal)
2. **ุชูุงุตูู ุงูุฃุตูุงู** ูู ุตูุญุฉ ุงูููุงุชูุฑ (Billing)
3. **ุตูุญุฉ BillView**

## ุงูุญููู ุงููุทุจูุฉ

### 1. ุชุญุณูู PartialPaymentModal.tsx โ

#### ุฃ) ุฅุถุงูุฉ useEffect ููุชุญุฏูุซ ุงูููุฑู
```typescript
// ุฅุนุงุฏุฉ ุชุนููู ุงูุนูุงุตุฑ ุงููุญุฏุฏุฉ ุนูุฏ ุชุญุฏูุซ ุจูุงูุงุช ุงููุงุชูุฑุฉ
useEffect(() => {
  if (bill) {
    setSelectedItems({});
  }
}, [bill?.itemPayments?.length, bill?.orders?.length, bill?.paid, bill?.remaining]);

// ุชุญุฏูุซ ููุฑู ููุจูุงูุงุช ุนูุฏ ุชุบููุฑ itemPayments
useEffect(() => {
  // ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุจูุงูุงุช ุนูุฏ ุชุญุฏูุซ ุงููุฏููุนุงุช
  if (bill?.itemPayments) {
    // ูุฑุถ ุฅุนุงุฏุฉ ุฑุณู ุงููููู
    setSelectedItems(prev => ({ ...prev }));
  }
}, [bill?.itemPayments]);
```

#### ุจ) ุฅุถุงูุฉ ููุชุงุญ ูุฑูุฏ ูููููู
```typescript
<PartialPaymentModal
  key={`partial-payment-${selectedBill?._id || selectedBill?.id}-${selectedBill?.itemPayments?.length || 0}-${selectedBill?.paid || 0}`}
  // ... ุจุงูู ุงูุฎุตุงุฆุต
/>
```

### 2. ุชุญุณูู handlePartialPaymentSubmit ูู Billing.tsx โ

#### ุฃ) ุชุญุณูู ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุจุนุฏ ุงูุฏูุน
```typescript
// ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุงููุญุฏุฏุฉ ููุญุตูู ุนูู ุฃุญุฏุซ ุงูุจูุงูุงุช
const refreshedBillResponse = await api.getBill(selectedBill.id || selectedBill._id);
if (refreshedBillResponse.success && refreshedBillResponse.data) {
  const updatedBill = refreshedBillResponse.data;
  
  // ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุงููุญุฏุฏุฉ ููุฑุงู
  setSelectedBill(updatedBill);
  
  // ูุฑุถ ุฅุนุงุฏุฉ ุฑุณู ุงูููููุงุช ุงูุชู ุชุนุชูุฏ ุนูู ุจูุงูุงุช ุงููุงุชูุฑุฉ
  setTimeout(() => {
    setSelectedBill({ ...updatedBill });
  }, 100);
  
  // ุจุงูู ุงูููุทู...
}
```

### 3. ุชุญุณูู ุชูุงุตูู ุงูุฃุตูุงู ูู Billing.tsx โ

#### ุฅุถุงูุฉ ููุชุงุญ ูุฑูุฏ ููุณู ุชูุงุตูู ุงูุฃุตูุงู
```typescript
<div 
  key={`item-details-${selectedBill._id || selectedBill.id}-${selectedBill.itemPayments?.length || 0}-${selectedBill.paid || 0}`}
  className="bg-gradient-to-br from-purple-50 to-pink-50..."
>
  {/* ูุญุชูู ุชูุงุตูู ุงูุฃุตูุงู */}
</div>
```

### 4. ุชุญุณูู BillView.tsx โ

#### ุฃ) ุชุณุฑูุน ุงูุชุญุฏูุซ ุงูุชููุงุฆู
```typescript
// ุชุญุฏูุซ ูู 5 ุซูุงูู ุจุฏูุงู ูู 10 ุซูุงูู
if (bill && bill.sessions && bill.sessions.some(session => session.status === 'active')) {
  interval = window.setInterval(() => fetchBill(false), 1000); // ูู ุซุงููุฉ
} else {
  interval = window.setInterval(() => fetchBill(false), 5000); // ูู 5 ุซูุงูู
}
```

#### ุจ) ุฅุถุงูุฉ ุชุญุฏูุซ ููุฑู ุนูุฏ ุชุบููุฑ ุงููุฏููุนุงุช
```typescript
// ุฅุถุงูุฉ ุชุฃุซูุฑ ููุฑุงูุจุฉ ุงูุชุบููุฑุงุช ูู ุงูุจูุงูุงุช ูุงูุฏูุนุงุช ุงูุฌุฒุฆูุฉ
useEffect(() => {
  // ูุฑุถ ุฅุนุงุฏุฉ ุฑุณู ุงููููู ุนูุฏ ุชุญุฏูุซ itemPayments
  if (bill?.itemPayments) {
    // ุชุญุฏูุซ ููุฑู ููุจูุงูุงุช
    const timer = setTimeout(() => {
      fetchBill(false);
    }, 500);
    return () => clearTimeout(timer);
  }
}, [bill?.itemPayments?.length, bill?.paid, bill?.remaining]);
```

## ุขููุฉ ุงูุนูู ุงููุญุณูุฉ

### 1. ุนูุฏ ูุชุญ ูุงูุฐุฉ ุงูุฏูุน ุงูุฌุฒุฆู:
1. ุงููููู ูุญูู ุจุฃุญุฏุซ ุงูุจูุงูุงุช ูู ุงููุงุชูุฑุฉ
2. ูุญุณุจ ุงููููุงุช ุงููุฏููุนุฉ ูุงููุชุจููุฉ ุจุฏูุฉ
3. ูุนุฑุถ ุงูุฃุฑูุงู ุงูุตุญูุญุฉ ููุฑุงู

### 2. ุนูุฏ ุชุฃููุฏ ุงูุฏูุน:
1. ุฅุฑุณุงู ุทูุจ ุงูุฏูุน ููุฎุงุฏู
2. ุฅุนุงุฏุฉ ุชุญููู ุจูุงูุงุช ุงูููุงุชูุฑ (`fetchBills()`)
3. ุฅุนุงุฏุฉ ุฌูุจ ุงููุงุชูุฑุฉ ุงููุญุฏุฏุฉ (`api.getBill()`)
4. ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุงููุญููุฉ ููุฑุงู
5. ูุฑุถ ุฅุนุงุฏุฉ ุฑุณู ุงูููููุงุช ุจุนุฏ 100ms
6. ุชุญุฏูุซ ุฌููุน ุงูุฃุฑูุงู ูู ุงููุงุฌูุฉ

### 3. ูู ุตูุญุฉ BillView:
1. ุชุญุฏูุซ ุชููุงุฆู ูู 5 ุซูุงูู
2. ุชุญุฏูุซ ููุฑู ุนูุฏ ุชุบููุฑ `itemPayments`
3. ุฅุนุงุฏุฉ ุญุณุงุจ ุงููููุงุช ุจุงุณุชุฎุฏุงู `aggregateItemsWithPayments`

## ุงูููุฒุงุช ุงููุญุณูุฉ

### โ **ุงูุชุญุฏูุซ ุงูููุฑู**
- ุงูุฃุฑูุงู ุชุชุญุฏุซ ุฎูุงู ุฃูู ูู ุซุงููุฉ ูุงุญุฏุฉ
- ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุฃู ุฅุบูุงู/ูุชุญ ุงููุงูุฐุฉ

### โ **ุงูุฏูุฉ ูู ุงูุญุณุงุจุงุช**
- ุงุณุชุฎุฏุงู `aggregateItemsWithPayments` ูุญุณุงุจ ุฏููู
- ูุฑุงุนุงุฉ ุงูุฃุตูุงู ุงููุชุดุงุจูุฉ ุนุจุฑ ุทูุจุงุช ูุชุนุฏุฏุฉ
- ุญุณุงุจ ุตุญูุญ ูููููุงุช ุงููุฏููุนุฉ ูุงููุชุจููุฉ

### โ **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ**
- ุฑุฏูุฏ ูุนู ููุฑูุฉ ุนูู ุงูุฅุฌุฑุงุกุงุช
- ุนุฑุถ ูุงุถุญ ููุชุบููุฑุงุช
- ุฅุบูุงู ุชููุงุฆู ูููุงูุฐุฉ ุนูุฏ ุงูุชูุงู ุงูุฏูุน

### โ **ุงูุงุณุชูุฑุงุฑ**
- ุนุฏู ููุฏุงู ุงูุจูุงูุงุช ุฃุซูุงุก ุงูุชุญุฏูุซ
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุจุดูู ุตุญูุญ
- ุนุฏู ุชุฏุงุฎู ุงูุนูููุงุช

## ุงุฎุชุจุงุฑ ุงููุธุงู

### 1. ุงุฎุชุจุงุฑ ูุงูุฐุฉ ุงูุฏูุน ุงูุฌุฒุฆู:
```bash
1. ุงูุชุญ ูุงุชูุฑุฉ ุชุญุชูู ุนูู ุฃุตูุงู ุบูุฑ ูุฏููุนุฉ
2. ุงููุฑ ุนูู "ุฏูุน ูุดุฑูุจ ูุนูู"
3. ุงุฎุชุฑ ูููุงุช ููุฏูุน
4. ุชุฃูุฏ ูู ุนุฑุถ ุงูุฃุฑูุงู ุงูุตุญูุญุฉ
5. ุงุถุบุท "ุชุฃููุฏ ุงูุฏูุน"
6. ุชุฃูุฏ ูู ุงูุชุญุฏูุซ ุงูููุฑู ููุฃุฑูุงู
7. ุชุฃูุฏ ูู ุฅุบูุงู ุงููุงูุฐุฉ ุฅุฐุง ุชู ุฏูุน ูู ุดูุก
```

### 2. ุงุฎุชุจุงุฑ ุชูุงุตูู ุงูุฃุตูุงู:
```bash
1. ุงูุชุญ ูุงุชูุฑุฉ ูู ุตูุญุฉ ุงูููุงุชูุฑ
2. ูุงุญุธ ุงูุฃุฑูุงู ูู ูุณู "ุชูุงุตูู ุงูุฃุตูุงู"
3. ูู ุจุฏูุน ุฌุฒุฆู
4. ุชุฃูุฏ ูู ุงูุชุญุฏูุซ ุงูููุฑู ููุฃุฑูุงู
5. ุชุฃูุฏ ูู ุฏูุฉ ุงูุญุณุงุจุงุช
```

### 3. ุงุฎุชุจุงุฑ BillView:
```bash
1. ุงูุชุญ ูุงุชูุฑุฉ ูู ุตูุญุฉ BillView
2. ูุงุญุธ ุงูุฃุฑูุงู ูู ุฌุฏูู ุงูุฃุตูุงู
3. ูู ุจุฏูุน ุฌุฒุฆู ูู ูุงูุฐุฉ ุฃุฎุฑู
4. ุชุฃูุฏ ูู ุงูุชุญุฏูุซ ุงูุชููุงุฆู ุฎูุงู 5 ุซูุงูู
5. ุชุฃูุฏ ูู ุฏูุฉ ุงูุฃุฑูุงู ุงููุนุฑูุถุฉ
```

## ุงููููุงุช ุงููุนุฏูุฉ

1. **`src/components/PartialPaymentModal.tsx`**
   - ุฅุถุงูุฉ useEffect ููุชุญุฏูุซ ุงูููุฑู
   - ุชุญุณูู ุฅุนุงุฏุฉ ุญุณุงุจ ุงูุจูุงูุงุช

2. **`src/pages/Billing.tsx`**
   - ุชุญุณูู `handlePartialPaymentSubmit`
   - ุฅุถุงูุฉ ููุงุชูุญ ูุฑูุฏุฉ ููููููุงุช
   - ุชุญุณูู ุชุญุฏูุซ ุงููุงุชูุฑุฉ ุงููุญุฏุฏุฉ

3. **`src/pages/BillView.tsx`**
   - ุชุณุฑูุน ุงูุชุญุฏูุซ ุงูุชููุงุฆู
   - ุฅุถุงูุฉ ุชุญุฏูุซ ููุฑู ูููุฏููุนุงุช

## ุงููุชูุฌุฉ ุงูููุงุฆูุฉ

๐ **ุงููุธุงู ูุนูู ุงูุขู ุจุดูู ูุซุงูู!**

- โ ุงูุชุญุฏูุซ ุงูููุฑู ููุฃุฑูุงู ูู ุฌููุน ุงููุงุฌูุงุช
- โ ุฏูุฉ ูู ุญุณุงุจ ุงููููุงุช ุงููุฏููุนุฉ ูุงููุชุจููุฉ
- โ ุชุฌุฑุจุฉ ูุณุชุฎุฏู ุณูุณุฉ ููุชุฌุงูุจุฉ
- โ ุงุณุชูุฑุงุฑ ูู ุงูุฃุฏุงุก ุจุฏูู ุฃุฎุทุงุก
- โ ุชุญุฏูุซ ุชููุงุฆู ูู ุงูุฎูููุฉ

ุงููุณุชุฎุฏููู ูููููู ุงูุขู ุฑุคูุฉ ุงูุชุญุฏูุซุงุช ุงูููุฑูุฉ ููุฃุฑูุงู ุจูุฌุฑุฏ ุชุฃููุฏ ุฃู ุฏูุน ุฌุฒุฆู! ๐