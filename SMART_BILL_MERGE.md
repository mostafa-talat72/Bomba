# ุงูุฏูุฌ ุงูุฐูู ููููุงุชูุฑ - ูุน ุงููุงุชูุฑุฉ ุงููุณุชูุฏูุฉ

## ุงูููุทู ุงููุญุณู
ุจุฏูุงู ูู ุงูุจุญุซ ุนู ูุงุชูุฑุฉ ุนุดูุงุฆูุฉ ููุฏูุฌ ูุนูุงุ ูุชู ุฏูุฌ ุงููุงุชูุฑุฉ ุงููุงุฑุบุฉ ูุน **ุงููุงุชูุฑุฉ ุงูุชู ุงูุชููุช ุฅูููุง ุงูุฌูุณุฉ** (finalBill).

## ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

### โ ููุทู ุฃูุซุฑ ูุถูุญุงู
- ุงูุฏูุฌ ูุน ุงููุงุชูุฑุฉ ุงููุณุชูุฏูุฉ ูุจุงุดุฑุฉ
- ูุง ุญุงุฌุฉ ููุจุญุซ ุนู ููุงุชูุฑ ุฃุฎุฑู
- ุงูุนูุงูุฉ ูุงุถุญุฉ ูููุทููุฉ

### โ ููู ุดุงูู ููุจูุงูุงุช
```javascript
// ููู ุงูููุงุญุธุงุช
let mergeNotes = '';
if (updatedCurrentBill.notes && updatedCurrentBill.notes.trim()) {
    mergeNotes = `\n[ูุฏูุฌ ูู ${updatedCurrentBill.billNumber}]: ${updatedCurrentBill.notes}`;
}

// ููู ุงููุฏููุนุงุช
if (updatedCurrentBill.payments && updatedCurrentBill.payments.length > 0) {
    finalBill.payments = finalBill.payments || [];
    finalBill.payments.push(...updatedCurrentBill.payments);
    
    const transferredAmount = updatedCurrentBill.payments.reduce((sum, payment) => sum + (payment.amount || 0), 0);
    finalBill.paid = (finalBill.paid || 0) + transferredAmount;
}

// ููู ุงููุฏููุนุงุช ุงูุฌุฒุฆูุฉ
if (updatedCurrentBill.partialPayments && updatedCurrentBill.partialPayments.length > 0) {
    finalBill.partialPayments = finalBill.partialPayments || [];
    finalBill.partialPayments.push(...updatedCurrentBill.partialPayments);
}
```

### โ ุชุญุฏูุซ ุฏููู ูููุฌุงููุน
```javascript
// ุฅุนุงุฏุฉ ุญุณุงุจ ุงููุฌุงููุน
await finalBill.calculateSubtotal();
finalBill.remaining = finalBill.total - (finalBill.paid || 0);
await finalBill.save();
```

## ุงูุนูููุฉ ุงููุงููุฉ

### 1. ุชุญุฏูุฏ ุงููุงุชูุฑุฉ ุงููุณุชูุฏูุฉ
```javascript
// finalBill ูู ุงููุงุชูุฑุฉ ุงูุชู ุงูุชููุช ุฅูููุง ุงูุฌูุณุฉ
// (ุฅูุง ูุงุชูุฑุฉ ููุฌูุฏุฉ ุฃู ูุงุชูุฑุฉ ุฌุฏูุฏุฉ ุชู ุฅูุดุงุคูุง)
```

### 2. ููู ุงูุจูุงูุงุช ุงููููุฏุฉ
- **ุงูููุงุญุธุงุช**: ูุน ุชุณููุฉ ูุงุถุญุฉ ูููุตุฏุฑ
- **ุงููุฏููุนุงุช**: ููู ูุงูู ูุน ุชุญุฏูุซ ุงููุจูุบ ุงููุฏููุน
- **ุงููุฏููุนุงุช ุงูุฌุฒุฆูุฉ**: ููู ูุงูู
- **ูุนูููุงุช ุงูุฏูุฌ**: ุชุณุฌูู ูุงุถุญ ูู ุงูููุงุญุธุงุช

### 3. ุชุญุฏูุซ ุงููุฌุงููุน
- ุฅุนุงุฏุฉ ุญุณุงุจ `subtotal`
- ุชุญุฏูุซ `remaining` = `total` - `paid`
- ุญูุธ ุงูุชุบููุฑุงุช

### 4. ุญุฐู ุงููุงุชูุฑุฉ ุงููุงุฑุบุฉ
- ุญุฐู ุขูู ุจุนุฏ ููู ุฌููุน ุงูุจูุงูุงุช
- ุชุณุฌูู ููุตู ููุนูููุฉ

## ูุซุงู ุนูู ุงูููุงุญุธุงุช ุงููุฏูุฌุฉ
```
ุงูููุงุญุธุงุช ุงูุฃุตููุฉ ูููุงุชูุฑุฉ ุงููุณุชูุฏูุฉ
[ุชู ุฏูุฌ ูุงุชูุฑุฉ ูุงุฑุบุฉ BILL-251216123456]
[ูุฏูุฌ ูู BILL-251216123456]: ููุงุญุธุงุช ุงููุงุชูุฑุฉ ุงูุฃุตููุฉ
[ุชู ููู ูุฏููุนุงุช ุจูููุฉ 50 ุฌ.ู]
```

## ุงูุชุณุฌูู ุงูููุตู
```javascript
Logger.info(`โ STEP 3: Successfully merged empty bill ${updatedCurrentBill.billNumber} with destination bill ${finalBill.billNumber}`, {
    finalBillTotal: finalBill.total,
    finalBillPaid: finalBill.paid,
    finalBillRemaining: finalBill.remaining
});
```

## ุงูุญุงูุงุช ุงููุฎุชููุฉ

### Case 1: ุงููุงุชูุฑุฉ ุงููุณุชูุฏูุฉ ููุฌูุฏุฉ ูุณุจูุงู
- ุฏูุฌ ูุน ูุงุชูุฑุฉ ููุฌูุฏุฉ ูู ุงูุทุงููุฉ ุงูุฌุฏูุฏุฉ
- ููู ุฌููุน ุงูุจูุงูุงุช ูุงููุฏููุนุงุช

### Case 2: ุฅูุดุงุก ูุงุชูุฑุฉ ุฌุฏูุฏุฉ
- ุฏูุฌ ูุน ุงููุงุชูุฑุฉ ุงูุฌุฏูุฏุฉ ุงูุชู ุชู ุฅูุดุงุคูุง
- ููู ุงูุจูุงูุงุช ุงููููุฏุฉ

## ุงููุฒุงูุง ุงูููุงุฆูุฉ

### โ ุงูุจุณุงุทุฉ
- ููุทู ูุงุถุญ ููุจุงุดุฑ
- ูุง ุญุงุฌุฉ ูุฎูุงุฑุฒููุงุช ุจุญุซ ูุนูุฏุฉ

### โ ุงูุฏูุฉ
- ุงูุฏูุฌ ูุน ุงููุงุชูุฑุฉ ุงูุตุญูุญุฉ ุฏุงุฆูุงู
- ูุง ููุฌุฏ ุงุญุชูุงู ููุฎุทุฃ ูู ุงุฎุชูุงุฑ ุงููุงุชูุฑุฉ

### โ ุงูุดููููุฉ
- ููู ุฌููุน ุงูุจูุงูุงุช ุงููููุฏุฉ
- ุนุฏู ููุฏุงู ุฃู ูุนูููุงุช

### โ ุงูุชุชุจุน
- ุชุณุฌูู ููุตู ููู ุนูููุฉ
- ููุงุญุธุงุช ูุงุถุญุฉ ุนู ูุตุฏุฑ ุงูุจูุงูุงุช

## ุงููููุงุช ุงููุญุฏุซุฉ
- `server/controllers/sessionController.js` - ุชุญุฏูุซ ููุทู ุงูุฏูุฌ ูู `changeSessionTable`

ุงูุขู ุงููุงุชูุฑุฉ ุงููุงุฑุบุฉ ุณุชูุฏูุฌ ุฏุงุฆูุงู ูุน ุงููุงุชูุฑุฉ ุงูุชู ุงูุชููุช ุฅูููุง ุงูุฌูุณุฉ! ๐ฏโจ