# ุฎุทูุงุช ุชุฑุญูู ูุฑุงุฌุน ุงูุทุงููุงุช - ุฏููู ุณุฑูุน

## ูุจู ุงูุจุฏุก
**โ๏ธ ููู ุฌุฏุงู: ุงุนูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!**

```bash
mongodump --uri="mongodb://localhost:27017/bomba" --out=./backup-$(date +%Y%m%d)
```

## ุงูุฎุทูุงุช

### 1. ุชุดุบูู ุณูุฑูุจุช ุงูุชุฑุญูู
```bash
npm run migrate:tables
```

ุฃู ูุจุงุดุฑุฉ:
```bash
cd server
node scripts/migrateTableReferences.js
```

### 2. ุฑุงุฌุน ุงูุชูุฑูุฑ
ุงูุณูุฑูุจุช ููุทุจุน ุชูุฑูุฑ ููุถุญ:
- โ ุนุฏุฏ ุงูููุงุชูุฑ ูุงูุทูุจุงุช ุงููู ุงุชุนุฏูุช ุจูุฌุงุญ
- โ๏ธ ุงูููุงุชูุฑ/ุงูุทูุจุงุช ุงููู ูุงููุงุด ูููุง ุทุงููุฉ ูุทุงุจูุฉ
- โ ุฃู ุฃุฎุทุงุก ุญุตูุช

### 3. ุนุงูุฌ ุงูุจูุงูุงุช ุบูุฑ ุงููุทุงุจูุฉ (ูู ููุฌูุฏุฉ)

#### ูู ุงูุทุงููุฉ ููุฌูุฏุฉ ุจุณ ูุด ุธุงูุฑุฉ:
ุชุฃูุฏ ุฅู ุงูุทุงููุฉ `isActive: true` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

#### ูู ุงูุทุงููุฉ ูุด ููุฌูุฏุฉ ุฎุงูุต:
**ุงูุฎูุงุฑ 1:** ุฃุถู ุงูุทุงููุฉ ุงูููููุฏุฉ ูู ูุงุฌูุฉ ุงููุธุงู

**ุงูุฎูุงุฑ 2:** ุฃุถููุง ูุฏููุงู ูู MongoDB:
```javascript
db.tables.insertOne({
  number: "A1",
  section: ObjectId("section_id"),
  organization: ObjectId("org_id"),
  isActive: true,
  createdBy: ObjectId("user_id"),
  createdAt: new Date(),
  updatedAt: new Date()
});
```

**ุงูุฎูุงุฑ 3:** ุงุญุฐู ุงูุญูู ููุจูุงูุงุช ุงููุฏููุฉ:
```javascript
db.bills.updateMany(
  { tableNumber: { $exists: true } },
  { $unset: { tableNumber: 1 } }
);
```

### 4. ุฃุนุฏ ุชุดุบูู ุงูุณูุฑูุจุช (ูู ุนุงูุฌุช ุจูุงูุงุช)
```bash
npm run migrate:tables
```

### 5. ุชุญูู ูู ุงููุชูุฌุฉ
```javascript
// ูู MongoDB shell
db.bills.countDocuments({ table: { $exists: true } })
db.bills.countDocuments({ tableNumber: { $exists: true } }) // ูุงุฒู ูููู 0

db.orders.countDocuments({ table: { $exists: true } })
db.orders.countDocuments({ tableNumber: { $exists: true } }) // ูุงุฒู ูููู 0
```

## ูุง ููุนูู ุงูุณูุฑูุจุช

1. **ููููุงุชูุฑ:**
   - ูุจุญุซ ุนู ูู ูุงุชูุฑุฉ ูููุง `tableNumber`
   - ููุงูู ุงูุทุงููุฉ ุงููุทุงุจูุฉ ูู ููุณ ุงููุคุณุณุฉ
   - ูุถูู `table: ObjectId` ููุญุฐู `tableNumber`

2. **ููุทูุจุงุช:**
   - ููุณ ุงูุนูููุฉ

## ูุซุงู ุนูู ุงูุชูุฑูุฑ

```
============================================================
๐ MIGRATION REPORT
============================================================

๐ Bills:
   Total: 150
   โ Matched & Updated: 145
   โ๏ธ  Not Matched: 5
   โ Errors: 0

๐ฆ Orders:
   Total: 320
   โ Matched & Updated: 315
   โ๏ธ  Not Matched: 5
   โ Errors: 0

๐ Summary:
   Total Documents: 470
   Successfully Migrated: 460
   Not Matched: 10
   Errors: 0
============================================================
```

## ุงุณุชุนุงุฏุฉ ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ (ูู ุญุตูุช ูุดููุฉ)

```bash
mongorestore --uri="mongodb://localhost:27017/bomba" --drop ./backup-20241120/bomba
```

## ููุงุญุธุงุช
- โ ุงูุณูุฑูุจุช ุขูู ููููู ุชุดุบูู ุฃูุชุฑ ูู ูุฑุฉ
- โ ูุงุจูุญุฐูุด ุฃู ุจูุงูุงุชุ ุจุณ ุจูุถูู ุญูู ุฌุฏูุฏ ููุญุฐู ุงููุฏูู
- โ ุจูุดุชุบู ุนูู ูุณุชูู ุงููุคุณุณุฉ ุนุดุงู ูุถูู ุงูุฏูุฉ
- โ ุจูุชุนุงูู ูุน ุงูุทุงููุงุช ุงููุดุทุฉ ุจุณ

## ุจุนุฏ ูุฌุงุญ ุงูุชุฑุญูู
ุงูุฎุทูุฉ ุงูุฌุงูุฉ ูู ุชุญุฏูุซ ุงูููุฏ ุนุดุงู ูุณุชุฎุฏู `table` ุจุฏู `tableNumber`:
1. ุชุญุฏูุซ Models
2. ุชุญุฏูุซ Controllers
3. ุชุญุฏูุซ Frontend
4. ุญุฐู ูู ุงูููุฏ ุงููุฏูู ุงููุชุนูู ุจู `tableNumber`
