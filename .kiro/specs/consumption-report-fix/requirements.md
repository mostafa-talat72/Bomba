# مستند المتطلبات

## المقدمة

تقرير الاستهلاك يعرض أرقام غير صحيحة للمبيعات. المشكلة الرئيسية هي أن التقرير يعتمد على الفواتير فقط لحساب مبيعات الكافيه، لكن بعض الطلبات قد لا تكون محسوبة بشكل صحيح في الفواتير، مما يؤدي إلى فرق كبير بين المبلغ الفعلي والمبلغ المعروض.

## المصطلحات

- **تقرير الاستهلاك (Consumption Report)**: تقرير يعرض جميع المبيعات من الكافيه والبلايستيشن خلال فترة زمنية محددة
- **الفاتورة (Bill)**: وثيقة تحتوي على طلبات و/أو جلسات بلايستيشن
- **الطلب (Order)**: طلب من الكافيه يحتوي على أصناف من القائمة
- **الجلسة (Session)**: جلسة بلايستيشن على جهاز معين
- **النظام (System)**: نظام إدارة المقهى Bomba

## المتطلبات

### المتطلب 1

**قصة المستخدم:** كمدير، أريد أن يعرض تقرير الاستهلاك الأرقام الصحيحة للمبيعات، حتى أتمكن من اتخاذ قرارات مالية دقيقة.

#### معايير القبول

1. WHEN يتم عرض تقرير الاستهلاك THEN النظام SHALL يحسب إجمالي المبيعات من جميع الطلبات المكتملة في الفترة المحددة
2. WHEN يتم عرض تقرير الاستهلاك THEN النظام SHALL يحسب إجمالي المبيعات من جميع جلسات البلايستيشن المكتملة في الفترة المحددة
3. WHEN يتم حساب المبيعات THEN النظام SHALL يجمع كميات الأصناف المتشابهة من جميع الطلبات
4. WHEN يتم حساب المبيعات THEN النظام SHALL يحسب الإجمالي الصحيح لكل صنف (الكمية × السعر)
5. WHEN يتم فلترة البيانات بالتاريخ THEN النظام SHALL يستخدم تاريخ إنشاء الطلب (createdAt) للطلبات وتاريخ انتهاء الجلسة (endTime) للجلسات

### المتطلب 2

**قصة المستخدم:** كمدير، أريد أن يعرض التقرير تفاصيل دقيقة لكل صنف، حتى أتمكن من معرفة الأصناف الأكثر مبيعاً.

#### معايير القبول

1. WHEN يتم عرض صنف في التقرير THEN النظام SHALL يعرض اسم الصنف والكمية الإجمالية والسعر والإجمالي
2. WHEN يتم عرض جلسات البلايستيشن THEN النظام SHALL يعرض عدد الساعات الإجمالية والتكلفة الإجمالية لكل جهاز
3. WHEN يتم حساب ساعات البلايستيشن THEN النظام SHALL يحسب الفرق بين startTime و endTime بالساعات
4. WHEN يتم عرض الأصناف THEN النظام SHALL يرتبها حسب الإجمالي من الأعلى إلى الأقل

### المتطلب 3

**قصة المستخدم:** كمدير، أريد أن يكون التقرير سريع التحميل، حتى لا أضيع الوقت في الانتظار.

#### معايير القبول

1. WHEN يتم تحميل التقرير THEN النظام SHALL يجلب البيانات مباشرة من الطلبات والجلسات بدلاً من الفواتير
2. WHEN يتم تغيير نطاق التاريخ THEN النظام SHALL يعيد حساب البيانات تلقائياً
3. WHEN يتم جلب البيانات THEN النظام SHALL يستخدم استعلامات قاعدة البيانات المحسّنة

### المتطلب 4

**قصة المستخدم:** كمدير، أريد أن يعرض التقرير إحصائيات ملخصة، حتى أحصل على نظرة سريعة على الأداء.

#### معايير القبول

1. WHEN يتم عرض التقرير THEN النظام SHALL يعرض إجمالي المبيعات الكلي
2. WHEN يتم عرض التقرير THEN النظام SHALL يعرض عدد الأصناف المباعة
3. WHEN يتم عرض التقرير THEN النظام SHALL يعرض عدد الفئات
4. WHEN يتم عرض التقرير THEN النظام SHALL يعرض الإجمالي لكل فئة (قسم من القائمة)
