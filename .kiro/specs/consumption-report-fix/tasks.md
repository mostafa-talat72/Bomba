# خطة التنفيذ

- [x] 1. إعادة هيكلة دالة معالجة البيانات في Frontend


  - إنشاء دالة جديدة `processOrdersAndSessions` تعالج الطلبات والجلسات مباشرة بدلاً من الفواتير
  - إزالة الاعتماد على `bills` في حساب البيانات
  - التأكد من جمع الأصناف المتشابهة بشكل صحيح
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [ ] 1.1 كتابة اختبار خاصية لدقة حساب إجمالي الطلبات
  - **Property 1: دقة حساب إجمالي الطلبات**
  - **Validates: Requirements 1.1, 1.4**

- [ ] 1.2 كتابة اختبار خاصية لدقة حساب إجمالي الجلسات
  - **Property 2: دقة حساب إجمالي الجلسات**
  - **Validates: Requirements 1.2**

- [ ] 1.3 كتابة اختبار خاصية لجمع الأصناف المتشابهة
  - **Property 3: جمع الأصناف المتشابهة**
  - **Validates: Requirements 1.3**

- [ ] 1.4 كتابة اختبار خاصية لصحة حساب الإجمالي لكل صنف
  - **Property 4: صحة حساب الإجمالي لكل صنف**
  - **Validates: Requirements 1.4**

- [ ] 2. تحديث دالة جلب البيانات (fetchData)
  - تعديل `fetchData` لجلب الطلبات والجلسات مباشرة بدلاً من الاعتماد على الفواتير
  - إضافة فلترة بالتاريخ للطلبات باستخدام `createdAt`
  - إضافة فلترة بالتاريخ للجلسات باستخدام `endTime`
  - التأكد من جلب الجلسات المكتملة فقط (`status: 'completed'`)
  - _Requirements: 1.5, 3.1_

- [ ] 2.1 كتابة اختبار خاصية لدقة فلترة التاريخ
  - **Property 5: دقة فلترة التاريخ**
  - **Validates: Requirements 1.5**

- [ ] 3. تحسين عرض بيانات الأصناف
  - التأكد من عرض جميع الحقول المطلوبة (name, quantity, price, total)
  - تحسين عرض ساعات البلايستيشن (عرض الساعات بدلاً من الكمية)
  - التأكد من عرض "-" بدلاً من السعر للبلايستيشن
  - _Requirements: 2.1, 2.2_

- [ ] 3.1 كتابة اختبار خاصية لاكتمال بيانات الصنف
  - **Property 6: اكتمال بيانات الصنف**
  - **Validates: Requirements 2.1**

- [ ] 3.2 كتابة اختبار خاصية لاكتمال بيانات الجلسة
  - **Property 7: اكتمال بيانات الجلسة**
  - **Validates: Requirements 2.2**

- [ ] 4. تحسين حساب ساعات البلايستيشن
  - إنشاء دالة `calculateSessionHours` لحساب الساعات من `startTime` و `endTime`
  - التعامل مع الحالات الخاصة (جلسات بدون `endTime`)
  - التأكد من دقة الحساب بالساعات
  - _Requirements: 2.3_

- [ ] 4.1 كتابة اختبار خاصية لدقة حساب ساعات البلايستيشن
  - **Property 8: دقة حساب ساعات البلايستيشن**
  - **Validates: Requirements 2.3**

- [ ] 5. تحسين ترتيب الأصناف
  - التأكد من ترتيب الأصناف حسب الإجمالي (من الأعلى إلى الأقل)
  - تطبيق الترتيب على جميع الفئات
  - _Requirements: 2.4_

- [ ] 5.1 كتابة اختبار خاصية لترتيب الأصناف
  - **Property 9: ترتيب الأصناف**
  - **Validates: Requirements 2.4**

- [ ] 6. تحديث عرض الإحصائيات الملخصة
  - التأكد من عرض إجمالي المبيعات الكلي بشكل صحيح
  - التأكد من عرض عدد الأصناف المباعة بشكل صحيح
  - التأكد من عرض عدد الفئات بشكل صحيح
  - التأكد من عرض الإجمالي لكل فئة بشكل صحيح
  - _Requirements: 4.1, 4.2, 4.3, 4.4_

- [ ] 6.1 كتابة اختبار خاصية لدقة الإجمالي الكلي
  - **Property 10: دقة الإجمالي الكلي**
  - **Validates: Requirements 4.1**

- [ ] 6.2 كتابة اختبار خاصية لدقة عدد الأصناف
  - **Property 11: دقة عدد الأصناف**
  - **Validates: Requirements 4.2**

- [ ] 6.3 كتابة اختبار خاصية لدقة عدد الفئات
  - **Property 12: دقة عدد الفئات**
  - **Validates: Requirements 4.3**

- [ ] 6.4 كتابة اختبار خاصية لدقة إجمالي كل فئة
  - **Property 13: دقة إجمالي كل فئة**
  - **Validates: Requirements 4.4**

- [ ] 7. تحسين معالجة الأخطاء
  - إضافة معالجة للحالة: لا توجد بيانات في الفترة المحددة
  - إضافة معالجة للحالة: خطأ في جلب البيانات من API
  - إضافة معالجة للحالة: بيانات غير صحيحة (null/undefined)
  - إضافة معالجة للحالة: جلسة بدون endTime
  - عرض رسائل خطأ واضحة للمستخدم
  - _Requirements: جميع المتطلبات_

- [ ] 7.1 كتابة اختبارات وحدة لمعالجة الأخطاء
  - اختبار معالجة البيانات الفارغة
  - اختبار معالجة البيانات غير الصحيحة
  - اختبار معالجة أخطاء API

- [ ] 8. تحسين الأداء
  - استخدام `useMemo` للبيانات المحسوبة
  - استخدام `useCallback` للدوال
  - تحسين عملية معالجة البيانات
  - _Requirements: 3.2, 3.3_

- [ ] 8.1 كتابة اختبارات أداء
  - قياس وقت معالجة البيانات
  - قياس وقت عرض التقرير
  - التأكد من عدم وجود re-renders غير ضرورية

- [ ] 9. Checkpoint - التأكد من نجاح جميع الاختبارات
  - تشغيل جميع الاختبارات والتأكد من نجاحها
  - مراجعة الكود والتأكد من جودته
  - اسأل المستخدم إذا كانت هناك أي أسئلة

- [ ] 10. اختبار التكامل النهائي
  - اختبار التقرير مع بيانات حقيقية
  - التأكد من دقة الأرقام مقارنة بقاعدة البيانات
  - اختبار جميع السيناريوهات (بيانات فارغة، بيانات كثيرة، إلخ)
  - اختبار تصدير PDF
  - _Requirements: جميع المتطلبات_

- [ ] 10.1 كتابة اختبارات تكامل
  - اختبار جلب البيانات من API
  - اختبار معالجة البيانات المجلوبة
  - اختبار عرض البيانات في UI

- [ ] 11. توثيق التغييرات
  - توثيق التغييرات في الكود
  - تحديث ملف README إذا لزم الأمر
  - إنشاء ملف CHANGELOG للتغييرات
  - _Requirements: جميع المتطلبات_
