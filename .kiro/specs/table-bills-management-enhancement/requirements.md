# Requirements Document

## Introduction

هذا المستند يحدد متطلبات تحسين نظام إدارة الفواتير والطاولات في نظام Bomba. الهدف هو تحسين طريقة عرض الفواتير المرتبطة بالطاولات، وتحديث حالة الطاولات بناءً على حالة الدفع، وتحسين نظام الدفع الجزئي للأصناف وجلسات البلايستيشن.

## Glossary

- **System**: نظام Bomba لإدارة المقاهي والمطاعم وصالات الألعاب
- **Bill**: الفاتورة التي تحتوي على طلبات وجلسات
- **Table**: الطاولة في المقهى أو المطعم
- **Order**: الطلب الذي يحتوي على أصناف من القائمة
- **Session**: جلسة البلايستيشن أو الكمبيوتر
- **Item**: الصنف في الطلب (مشروب، طعام، إلخ)
- **Partial Payment**: الدفع الجزئي لجزء من الفاتورة
- **Table Status**: حالة الطاولة (فارغة أو محجوزة)
- **Unpaid Bill**: فاتورة غير مدفوعة بالكامل (draft, partial, overdue)
- **Paid Bill**: فاتورة مدفوعة بالكامل

## Requirements

### Requirement 1: إزالة فلترة التاريخ من صفحة الفواتير

**User Story:** كمستخدم للنظام، أريد أن أرى جميع الفواتير بغض النظر عن تاريخ إنشائها، حتى أتمكن من متابعة جميع الفواتير في النظام.

#### Acceptance Criteria

1. WHEN المستخدم يفتح صفحة الفواتير THEN النظام SHALL يعرض جميع الفواتير بدون تطبيق أي فلترة بالتاريخ
2. WHEN المستخدم يطلب فواتير من API THEN النظام SHALL لا يطبق فلترة التاريخ تلقائياً
3. WHEN النظام يستقبل معاملات التاريخ (startDate, endDate) في الطلب THEN النظام SHALL يتجاهل هذه المعاملات بالكامل

### Requirement 2: تحديث حالة الطاولة بناءً على الفواتير غير المدفوعة

**User Story:** كمستخدم للنظام، أريد أن تتحدث حالة الطاولة تلقائياً بناءً على وجود فواتير غير مدفوعة، حتى أعرف أي الطاولات محجوزة وأيها فارغة.

#### Acceptance Criteria

1. WHEN توجد فاتورة واحدة أو أكثر غير مدفوعة للطاولة THEN النظام SHALL يضبط حالة الطاولة على "occupied"
2. WHEN جميع فواتير الطاولة مدفوعة بالكامل THEN النظام SHALL يضبط حالة الطاولة على "empty"
3. WHEN يتم إنشاء فاتورة جديدة للطاولة THEN النظام SHALL يحدث حالة الطاولة فوراً
4. WHEN يتم دفع فاتورة بالكامل THEN النظام SHALL يحدث حالة الطاولة فوراً
5. WHEN يتم حذف فاتورة THEN النظام SHALL يحدث حالة الطاولة بناءً على الفواتير المتبقية

### Requirement 3: الدفع الجزئي للأصناف المحددة

**User Story:** كمستخدم للنظام، أريد أن أدفع لأصناف محددة من الفاتورة، حتى يتمكن العملاء من الدفع بشكل منفصل لكل صنف.

#### Acceptance Criteria

1. WHEN المستخدم يختار أصناف محددة للدفع THEN النظام SHALL يجمع جميع الأصناف المتشابهة من كل الطلبات المرتبطة بالفاتورة
2. WHEN المستخدم يدفع لصنف معين THEN النظام SHALL يحدث حالة الصنف إلى "مدفوع" ويسجل المبلغ المدفوع
3. WHEN المستخدم يدفع لصنف THEN النظام SHALL يعرض الكمية المدفوعة والكمية المتبقية لهذا الصنف
4. WHEN جميع الأصناف في الفاتورة مدفوعة THEN النظام SHALL يحدث حالة الفاتورة بناءً على حالة الجلسات
5. WHEN المستخدم يعرض الفاتورة THEN النظام SHALL يعرض جدول يحتوي على: اسم الصنف، الكمية الكلية، الكمية المدفوعة، الكمية المتبقية، السعر، الإجمالي

### Requirement 4: الدفع الجزئي لجلسات البلايستيشن

**User Story:** كمستخدم للنظام، أريد أن أقبل دفعات جزئية لجلسات البلايستيشن، حتى يتمكن العملاء من الدفع على دفعات.

#### Acceptance Criteria

1. WHEN المستخدم يدفع مبلغ جزئي لجلسة بلايستيشن THEN النظام SHALL يسجل المبلغ المدفوع ويحسب المبلغ المتبقي
2. WHEN المستخدم يدفع مبلغ أكبر من المبلغ المتبقي THEN النظام SHALL يرفض الدفع ويعرض رسالة خطأ
3. WHEN المستخدم يدفع مبلغ جزئي THEN النظام SHALL يضيف الدفعة إلى سجل الدفعات الجزئية للجلسة
4. WHEN المستخدم يعرض الفاتورة THEN النظام SHALL يعرض المبلغ المدفوع والمبلغ المتبقي لكل جلسة
5. WHEN جميع الجلسات مدفوعة بالكامل وجميع الأصناف مدفوعة THEN النظام SHALL يضبط حالة الفاتورة على "paid"

### Requirement 5: عرض تفاصيل الدفع في صفحة BillView

**User Story:** كمستخدم للنظام، أريد أن أرى تفاصيل الدفع الجزئي في صفحة عرض الفاتورة، حتى أعرف ما تم دفعه وما المتبقي.

#### Acceptance Criteria

1. WHEN المستخدم يعرض فاتورة تحتوي على دفعات جزئية للأصناف THEN النظام SHALL يعرض جدول يحتوي على: الصنف، الكمية الكلية، الكمية المدفوعة، الكمية المتبقية
2. WHEN المستخدم يعرض فاتورة تحتوي على دفعات جزئية للجلسات THEN النظام SHALL يعرض المبلغ المدفوع والمبلغ المتبقي لكل جلسة
3. WHEN المستخدم يطبع الفاتورة THEN النظام SHALL يتضمن تفاصيل الدفع الجزئي في الطباعة
4. WHEN صنف مدفوع بالكامل THEN النظام SHALL يميز الصنف بلون مختلف (مثل خلفية خضراء)
5. WHEN جلسة مدفوعة بالكامل THEN النظام SHALL يعرض علامة "مدفوع بالكامل" بجانب الجلسة

### Requirement 6: تجميع الأصناف المتشابهة

**User Story:** كمستخدم للنظام، أريد أن يتم تجميع الأصناف المتشابهة من كل الطلبات المرتبطة بالفاتورة، حتى أرى الكمية الإجمالية لكل صنف.

#### Acceptance Criteria

1. WHEN الفاتورة تحتوي على نفس الصنف في طلبات مختلفة THEN النظام SHALL يجمع الكميات ويعرض صنف واحد بالكمية الإجمالية
2. WHEN الصنف له نفس الاسم ولكن سعر مختلف THEN النظام SHALL يعرضهما كأصناف منفصلة
3. WHEN الصنف له إضافات (addons) THEN النظام SHALL يجمع الأصناف التي لها نفس الإضافات معاً
4. WHEN المستخدم يدفع لصنف مجمع THEN النظام SHALL يوزع الدفع على جميع الطلبات التي تحتوي على هذا الصنف
5. WHEN المستخدم يعرض الفاتورة THEN النظام SHALL يعرض الأصناف المجمعة بنفس الطريقة في صفحة BillView

### Requirement 7: تحديث الواجهة الأمامية لصفحة الفواتير

**User Story:** كمستخدم للنظام، أريد واجهة محسنة لعرض فواتير الطاولات، حتى أتمكن من إدارة الفواتير بسهولة.

#### Acceptance Criteria

1. WHEN المستخدم ينقر على طاولة THEN النظام SHALL يعرض جميع فواتير هذه الطاولة في نافذة منبثقة
2. WHEN المستخدم يعرض فواتير الطاولة THEN النظام SHALL يوفر فلتر لعرض الفواتير غير المدفوعة فقط أو جميع الفواتير
3. WHEN المستخدم يختار فاتورة THEN النظام SHALL يعرض خيارات: عرض، تعديل، دفع
4. WHEN المستخدم ينقر على "عرض" THEN النظام SHALL يفتح الفاتورة في نافذة جديدة
5. WHEN المستخدم ينقر على "دفع" THEN النظام SHALL يفتح نافذة الدفع مع خيارات الدفع الكامل والجزئي

### Requirement 8: تحديث Real-time للبيانات

**User Story:** كمستخدم للنظام، أريد أن تتحدث البيانات تلقائياً عند حدوث تغييرات، حتى أرى أحدث المعلومات دائماً.

#### Acceptance Criteria

1. WHEN يتم إنشاء فاتورة جديدة THEN النظام SHALL يرسل إشعار Socket.IO لتحديث قائمة الفواتير
2. WHEN يتم دفع فاتورة أو دفع جزئي THEN النظام SHALL يرسل إشعار Socket.IO لتحديث حالة الفاتورة والطاولة
3. WHEN يتم حذف فاتورة THEN النظام SHALL يرسل إشعار Socket.IO لتحديث قائمة الفواتير وحالة الطاولة
4. WHEN يتم تحديث حالة طاولة THEN النظام SHALL يرسل إشعار Socket.IO لتحديث عرض الطاولات
5. WHEN المستخدم يعرض صفحة الفواتير THEN النظام SHALL يستمع لإشعارات Socket.IO ويحدث العرض تلقائياً
