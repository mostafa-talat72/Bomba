  # Implementation Plan

- [x] 1. إضافة فلتر التاريخ والساعة في Frontend





  - إضافة state لـ `dateRange` و `timeRange` في مكون Reports
  - إضافة state لـ `filterMode` للتبديل بين الفلتر السريع والمخصص
  - إنشاء مكون `DateTimeFilter` مع DatePicker و TimePicker منفصلين
  - إضافة دالة `handleDateChange` للحفاظ على الساعة عند تغيير التاريخ
  - إضافة دالة `handleTimeChange` للحفاظ على التاريخ عند تغيير الساعة
  - إضافة ملخص الفترة المحددة بتنسيق واضح (مثل: "الأحد، 15 يناير 2024 عند 02:30 م")
  - تحديث دالة `buildFilter` لدعم الفلتر المخصص بالساعة
  - _Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8_

- [x] 2. إضافة دوال مساعدة جديدة في Backend





  - إضافة دالة `getTopProductsBySection` لجلب المنتجات الأكثر مبيعاً مصنفة حسب أقسام المنيو
  - إضافة دالة `getSessionsDataByType` لجلب بيانات الجلسات حسب النوع (بلايستيشن/كمبيوتر)
  - إضافة دالة `getPeakHoursData` لتحليل ساعات الذروة
  - إضافة دالة `getStaffPerformanceData` لتحليل أداء الموظفين
  - إضافة دالة `calculateComparison` لحساب المقارنة مع الفترة السابقة
  - _Requirements: 1.1, 2.1, 5.1, 6.1, 7.1_

- [x] 3. تحديث API endpoint للمبيعات





  - تعديل `getSalesReport` لإرجاع بيانات الفترة الحالية والسابقة
  - إضافة `topProductsBySection` إلى الاستجابة
  - إضافة `peakHours` إلى الاستجابة
  - إضافة `staffPerformance` إلى الاستجابة
  - إضافة `comparison` إلى الاستجابة
  - _Requirements: 1.1, 5.1, 6.1, 7.1_

- [x] 4. تحديث API endpoint للجلسات





  - تعديل `getSessionsReport` لفصل بيانات البلايستيشن والكمبيوتر
  - إضافة `controllerDistribution` لبيانات البلايستيشن
  - إضافة `deviceUsage` لكل نوع جهاز
  - حساب `usageRate` لكل جهاز
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 5. إنشاء مكون TopProductsBySection في Frontend





  - إنشاء interface `ProductSalesBySection`
  - إنشاء مكون `TopProductsBySection` مع إمكانية الطي/الفتح
  - إضافة state لإدارة الأقسام المفتوحة
  - عرض إجمالي الإيراد والكمية لكل قسم
  - عرض أكثر 5 منتجات لكل قسم
  - _Requirements: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 6. إنشاء مكونات جلسات البلايستيشن والكمبيوتر المنفصلة









  - إنشاء interface `SessionsData`
  - إنشاء مكون `PlayStationSessionsReport`
  - إنشاء مكون `ComputerSessionsReport`
  - عرض إحصائيات كل نوع بشكل منفصل
  - عرض توزيع الدراعات للبلايستيشن
  - عرض أكثر الأجهزة استخداماً لكل نوع
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5_

- [x] 7. إنشاء مكون المقارنة مع الفترة السابقة





  - إنشاء interface `ComparisonData`
  - إنشاء مكون `StatCardWithComparison`
  - عرض سهم للأعلى/الأسفل حسب التغيير
  - استخدام ألوان مناسبة (أخضر/أحمر)
  - عرض النسبة المئوية للتغيير
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 8. إنشاء مكون ساعات الذروة





  - إنشاء interface `PeakHoursData`
  - إنشاء مكون `PeakHoursChart`
  - إضافة رسم بياني شريطي لتوزيع المبيعات/الجلسات حسب الساعة
  - تمييز ساعات الذروة (أعلى 3 ساعات) بلون مختلف
  - إضافة إمكانية التبديل بين المبيعات والجلسات
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 9. إنشاء مكون أداء الموظفين





  - إنشاء interface `StaffPerformance`
  - إنشاء مكون `StaffPerformanceTable`
  - عرض جدول بإحصائيات كل موظف
  - ترتيب الموظفين حسب الإيراد الإجمالي
  - عرض متوسط قيمة الطلب لكل موظف
  - _Requirements: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 10. تحديث صفحة التقارير الرئيسية





  - دمج مكون `DateTimeFilter` في صفحة التقارير
  - استبدال قسم "أكثر المنتجات مبيعاً" بمكون `TopProductsBySection`
  - استبدال قسم "تحليل الجلسات" بمكونات منفصلة للبلايستيشن والكمبيوتر
  - تحديث بطاقات الإحصائيات لتشمل المقارنة مع الفترة السابقة
  - إضافة قسم "ساعات الذروة"
  - إضافة قسم "أداء الموظفين"
  - _Requirements: 1.1, 2.1, 3.1, 5.1, 6.1, 7.1, 8.1_

- [x] 11. تحديث دوال جلب البيانات في Frontend





  - تحديث `getSalesReport` لاستقبال البيانات الجديدة
  - تحديث `getSessionsReport` لاستقبال البيانات المنفصلة
  - إضافة معالجة للبيانات الجديدة (comparison, peakHours, staffPerformance)
  - تحديث state management لتخزين البيانات الجديدة
  - تحديث `buildFilter` لاستخدام التاريخ والساعة من DateTimeFilter
  - _Requirements: 1.1, 2.1, 5.1, 6.1, 7.1, 8.5, 8.8_

- [x] 12. تحديث وظائف التصدير









  - تحديث `exportReportToExcel` لتشمل البيانات الجديدة
  - تحديث `exportReportToPDF` لتشمل البيانات الجديدة
  - التأكد من تنسيق البيانات بشكل صحيح في الملفات المصدرة
  - إضافة الفترة الزمنية (مع الساعة) وتاريخ التصدير في الملفات
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 13. إضافة معالجة الأخطاء والحالات الخاصة
  - إضافة معالجة لحالة عدم وجود بيانات
  - إضافة معالجة لحالة فشل جلب البيانات
  - إضافة رسائل توضيحية للحالات الخاصة
  - إضافة زر "إعادة المحاولة" عند فشل جلب البيانات
  - _Requirements: 1.5, 5.4_

- [ ] 14. تحسين الأداء والتحميل
  - إضافة loading states لكل قسم
  - تحسين استعلامات قاعدة البيانات باستخدام indexes
  - استخدام `lean()` في الاستعلامات المناسبة
  - إضافة pagination للبيانات الكبيرة إذا لزم الأمر
  - _Requirements: جميع المتطلبات_

- [ ] 15. اختبار الوظائف الجديدة
  - اختبار فلتر التاريخ والساعة المخصص
  - اختبار عرض المنتجات حسب أقسام المنيو
  - اختبار فصل جلسات البلايستيشن والكمبيوتر
  - اختبار المقارنة مع الفترة السابقة
  - اختبار ساعات الذروة
  - اختبار أداء الموظفين
  - اختبار التصدير للملفات
  - اختبار معالجة الأخطاء
  - _Requirements: جميع المتطلبات_
