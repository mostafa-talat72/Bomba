# تنفيذ عرض فواتير الجلسات الغير مرتبطة بطاولة

## التاريخ
2 ديسمبر 2025

## الوصف
تم إضافة قسم جديد في صفحة أجهزة البلايستيشن لعرض فواتير الجلسات الغير مرتبطة بطاولة.

## التغييرات المنفذة

### 1. صفحة البلايستيشن (`src/pages/PlayStation.tsx`)

#### إضافة `bills` إلى الـ Context
```typescript
const { sessions, createSession, endSession, user, createDevice, bills, fetchBills, showNotification, tables, fetchTables, fetchTableSections, fetchSessions } = useApp();
```

#### إضافة قسم جديد لعرض الفواتير الغير مرتبطة
تم إضافة قسم جديد قبل قسم "الجلسات النشطة" يعرض:
- جميع فواتير البلايستيشن الغير مرتبطة بطاولة
- حالة الفاتورة (مدفوع / مدفوع جزئياً / غير مدفوع)
- معلومات الجلسات المرتبطة بالفاتورة
- حالة الجلسة (نشطة / منتهية)
- أزرار للعرض والدفع

## المميزات

### 1. فلترة ذكية
```typescript
const unlinkedSessionBills = bills.filter((bill: any) => 
  !bill.table && 
  (bill.billType === 'playstation' || 
   (bill.sessions && bill.sessions.some((s: any) => s.deviceType === 'playstation')))
);
```

### 2. عرض معلومات شاملة
- رقم الفاتورة
- اسم العميل
- حالة الفاتورة مع ألوان مميزة
- معلومات الجلسات (اسم الجهاز، عدد الأذرع، الحالة)
- المبلغ الإجمالي والمتبقي

### 3. مؤشرات بصرية
- **جلسة نشطة**: شارة زرقاء مع نقطة متحركة
- **مدفوع**: شارة خضراء
- **مدفوع جزئياً**: شارة صفراء
- **غير مدفوع**: شارة حمراء

### 4. أزرار التفاعل
- **عرض الفاتورة**: يفتح الفاتورة في نافذة جديدة
- **دفع**: ينتقل إلى صفحة الفواتير مع تحديد الفاتورة

## واجهة المستخدم

### التصميم
- كارت لكل فاتورة مع خلفية رمادية فاتحة
- حدود تتغير عند التمرير (hover effect)
- تصميم متجاوب يعمل على جميع الشاشات
- دعم الوضع الداكن (Dark Mode)

### الترتيب
1. قسم الأجهزة (Device Cards)
2. **قسم فواتير الجلسات الغير مرتبطة** ← جديد
3. قسم الجلسات النشطة

## الاختبار

### سيناريوهات الاختبار
1. ✅ إنشاء جلسة بدون طاولة
2. ✅ إنهاء الجلسة وإنشاء فاتورة
3. ✅ التحقق من ظهور الفاتورة في القسم الجديد
4. ✅ اختبار زر "عرض الفاتورة"
5. ✅ اختبار زر "دفع"
6. ✅ التحقق من عدم ظهور الفواتير المرتبطة بطاولة

### حالات الحافة
- ✅ لا توجد فواتير غير مرتبطة (القسم لا يظهر)
- ✅ فاتورة مع جلسة نشطة
- ✅ فاتورة مع جلسات متعددة
- ✅ فاتورة مدفوعة بالكامل

## الأداء
- لا يؤثر على سرعة التحميل (الفواتير تُحمل في الخلفية)
- الفلترة تتم على جانب العميل (سريعة جداً)
- لا توجد استدعاءات API إضافية

## التوافق
- ✅ متوافق مع جميع المتصفحات الحديثة
- ✅ يعمل على الشاشات الصغيرة والكبيرة
- ✅ يدعم الوضع الداكن
- ✅ يدعم اللغة العربية (RTL)

## الملاحظات
- القسم يظهر فقط إذا كانت هناك فواتير غير مرتبطة بطاولة
- الفواتير المرتبطة بطاولة لا تظهر في هذا القسم
- يتم تحديث القسم تلقائياً عند إنشاء أو تعديل فاتورة

## الخطوات التالية (اختياري)
- [ ] إضافة إمكانية الدفع مباشرة من صفحة البلايستيشن
- [ ] إضافة فلترة حسب حالة الفاتورة
- [ ] إضافة بحث عن فاتورة معينة
- [ ] إضافة إمكانية طباعة الفاتورة مباشرة
