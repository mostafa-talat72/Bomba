# خطة تنفيذ نظام إدارة جلسات البلايستيشن المحسّن

- [x] 1. تحسين نافذة إنهاء الجلسة لطلب اسم العميل





  - إضافة modal جديد لإنهاء الجلسة يطلب اسم العميل إذا لم تكن الجلسة مرتبطة بطاولة
  - تحديث دالة `handleEndSession` لفحص حالة ربط الطاولة قبل الإنهاء
  - إضافة state جديد لتخزين اسم العميل المدخل
  - إضافة validation للتأكد من إدخال اسم العميل للجلسات غير المرتبطة بطاولات
  - _المتطلبات: 2.4, 4.2_

- [x] 2. تحسين عرض الفواتير في صفحة Billing





  - إضافة قسم منفصل لعرض فواتير البلايستيشن في صفحة الفواتير
  - عرض الأجهزة النشطة مع معلومات الجلسة والفاتورة المرتبطة
  - إضافة فلتر لعرض الفواتير حسب النوع (كافيه، بلايستيشن، كمبيوتر)
  - عرض حالة ربط الطاولة لكل جلسة بلايستيشن
  - عرض اسم العميل للجلسات غير المرتبطة بطاولات
  - _المتطلبات: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3. تحسين حساب التكلفة الديناميكي





  - التأكد من أن دالة `calculateCost` في Session Model تحسب التكلفة بدقة بناءً على controllersHistory
  - إضافة دالة `calculateCurrentCost` لحساب التكلفة الحالية للجلسات النشطة
  - تحديث الواجهة الأمامية لعرض التكلفة الحالية المحدثة كل دقيقة
  - التأكد من حفظ controllersHistory بشكل صحيح عند تعديل عدد الأذرع
  - _المتطلبات: 6.1, 6.2, 6.3, 6.4, 6.5_

- [x] 4. تحسين استعادة البيانات عند إعادة التحميل





  - التأكد من أن جميع الجلسات النشطة تُحمّل بشكل صحيح عند إعادة تحميل الصفحة
  - إعادة حساب التكلفة الحالية لكل جلسة نشطة عند التحميل
  - التأكد من عرض حالة ربط الطاولة بشكل صحيح بعد إعادة التحميل
  - إضافة معالجة أخطاء واضحة في حالة فشل تحميل البيانات
  - _المتطلبات: 5.1, 5.2, 5.3, 5.4, 5.5_

- [x] 5. تحسين واجهة المستخدم والتجربة





  - إضافة مؤشرات تحميل واضحة لجميع العمليات
  - تحسين رسائل الخطأ لتكون أكثر وضوحاً ومفيدة
  - إضافة رسائل تأكيد قبل العمليات المهمة (إنهاء الجلسة، تعديل عدد الأذرع)
  - استخدام ألوان وأيقونات واضحة للتمييز بين الحالات المختلفة
  - تحسين responsive design للشاشات الصغيرة
  - _المتطلبات: 7.1, 7.2, 7.3, 7.4, 7.5_

- [x] 6. التحقق من عمل ربط الجلسة بالطاولة





  - التأكد من أن دالة `handleLinkTableToSession` تعمل بشكل صحيح
  - التحقق من تحديث الفاتورة عند ربط الجلسة بطاولة
  - التحقق من إمكانية ربط الجلسة بطاولة أثناء التشغيل
  - التحقق من إمكانية ربط الجلسة بطاولة عند الإنهاء
  - عرض حالة ربط الطاولة بشكل واضح في الواجهة
  - _المتطلبات: 2.1, 2.2, 2.3, 2.5_

- [x] 7. التحقق من عمل تعديل عدد الأذرع





  - التأكد من أن أزرار +/- لتعديل عدد الأذرع تعمل بشكل صحيح
  - التحقق من تحديث controllersHistory عند كل تعديل
  - التحقق من إعادة حساب التكلفة بعد تعديل عدد الأذرع
  - التحقق من تحديث الفاتورة المرتبطة بعد تعديل عدد الأذرع
  - عرض السعر الحالي للساعة بناءً على عدد الأذرع الحالي
  - _المتطلبات: 1.1, 1.2, 1.3, 1.4, 1.5_

- [x] 8. اختبار شامل للنظام





  - اختبار بدء جلسة جديدة بدون طاولة
  - اختبار بدء جلسة جديدة مع طاولة
  - اختبار تعديل عدد الأذرع أثناء الجلسة النشطة
  - اختبار ربط جلسة نشطة بطاولة
  - اختبار إنهاء جلسة مرتبطة بطاولة
  - اختبار إنهاء جلسة غير مرتبطة بطاولة (مع طلب اسم العميل)
  - اختبار إعادة تحميل الصفحة مع جلسات نشطة
  - اختبار عرض الفواتير في صفحة Billing
  - اختبار حساب التكلفة بدقة مع تغييرات متعددة في عدد الأذرع
  - _المتطلبات: جميع المتطلبات_

- [x] 9. كتابة اختبارات الوحدة





  - كتابة اختبارات لدالة `calculateCost` في Session Model
  - كتابة اختبارات لدالة `updateControllers` في Session Model
  - كتابة اختبارات لدالة `endSession` في Session Model
  - كتابة اختبارات لدالة `calculateSubtotal` في Bill Model
  - _المتطلبات: جميع المتطلبات_

- [x] 10. كتابة اختبارات التكامل






  - كتابة اختبارات لـ API endpoint إنشاء جلسة
  - كتابة اختبارات لـ API endpoint تعديل عدد الأذرع
  - كتابة اختبارات لـ API endpoint إنهاء جلسة
  - كتابة اختبارات لـ API endpoint ربط جلسة بطاولة
  - _المتطلبات: جميع المتطلبات_

- [x] 11. تنفيذ ميزة فك ربط الجلسة من الطاولة




  - إضافة API endpoint جديد لفك ربط الجلسة من الطاولة (PUT /api/sessions/:sessionId/unlink-table)
  - تنفيذ منطق فصل الفاتورة عن الطاولة في الـ backend
  - معالجة الحالات الخاصة (طاولة بها طلبات كافيه + جلسة، طاولة بها جلسة فقط)
  - تحديث حالة الطاولة عند فك الربط
  - إضافة حقل tableHistory في Session Model لتتبع تاريخ الربط وفك الربط
  - _المتطلبات: 2.1.1, 2.1.2, 2.1.3, 2.1.5, 2.1.6, 2.1.7_


- [ ] 11.1 تحديث الواجهة الأمامية لدعم فك الربط
  - إضافة زر "فك الربط من الطاولة" في مكون عرض الجلسة النشطة
  - إضافة نافذة تأكيد توضح تأثير فك الربط
  - إضافة نافذة لطلب اسم العميل إذا لم يكن موجوداً
  - تحديث دالة handleUnlinkTableFromSession في صفحة البلايستيشن
  - تحديث عرض الجلسة لإظهار "بدون طاولة" بعد فك الربط

  - _المتطلبات: 2.1.1, 2.1.4_

- [ ] 11.2 تحديث صفحة الفواتير لدعم نقل الفواتير
  - التأكد من نقل الفاتورة من قسم الطاولات إلى قسم البلايستيشن عند فك الربط
  - تحديث العرض تلقائياً عند حدوث فك الربط
  - عرض رسالة نجاح بعد فك الربط
  - _المتطلبات: 2.1.3_

- [ ]* 11.3 كتابة اختبارات لميزة فك الربط
  - كتابة اختبارات وحدة لدالة فك الربط في Session Model
  - كتابة اختبارات تكامل لـ API endpoint فك الربط
  - اختبار الحالات الخاصة (طاولة بها طلبات + جلسة، طاولة بها جلسة فقط)
  - اختبار معالجة الأخطاء (جلسة غير مرتبطة، اسم عميل مفقود)
  - _المتطلبات: 2.1 (جميع المعايير)_
