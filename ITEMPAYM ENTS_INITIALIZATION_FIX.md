# ุฅุตูุงุญ ูุดููุฉ ุชููุฆุฉ itemPayments

## ๐จ ุงููุดููุฉ ุงูููุชุดูุฉ

### ุงูุฃุนุฑุงุถ
- ุงููุงุชูุฑุฉ ุชุธูุฑ: ุงููุฏููุน = 0 ุฌ.ูุ ุงููุชุจูู = 470 ุฌ.ู
- ุงูุฃุตูุงู ุชุธูุฑ: ุฌููุนูุง "ูุฏููุนุฉ ุจุงููุงูู" (ุงููุฏููุน = ุงููููุฉ ุงููููุฉุ ุงููุชุจูู = 0)

### ุงูุณุจุจ ุงูุฌุฐุฑู
ุงููุธุงู ูุงู ููููุฆ `itemPayments` ุจููู ุงูุชุฑุงุถูุฉ (`paidQuantity: 0`) ูุฌููุน ุงูููุงุชูุฑุ ุญุชู ุงูุชู ูู ูุชู ุฏูุน ุฃู ุดูุก ูููุง. ูุฐุง ูุณุจุจ ุชุถุงุฑุจุงู ูู ููุทู ุงูุนุฑุถ.

## โ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุฅุตูุงุญ ุชููุฆุฉ itemPayments
```javascript
// ูุจู ุงูุฅุตูุงุญ โ
this.itemPayments.push({
    paidQuantity: 0,  // ููููุฆ ุฏุงุฆูุงู ุญุชู ููููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
    // ...
});

// ุจุนุฏ ุงูุฅุตูุงุญ โ
// Only add itemPayments for bills that actually have payments
if (this.paid > 0 || this.status === 'partial' || this.status === 'paid') {
    this.itemPayments.push({
        paidQuantity: 0,
        // ...
    });
}
```

### 2. ุชุญุณูู ููุทู aggregateItemsWithPayments
```javascript
// ูุจู ุงูุฅุตูุงุญ โ
if (!itemPayments || itemPayments.length === 0) {
    return calculatePaidQuantityFromBillRatio(...);
}

// ุจุนุฏ ุงูุฅุตูุงุญ โ
if (!itemPayments || itemPayments.length === 0) {
    if (!billPaid || billPaid === 0) {
        return 0; // ูุง ุชูุฌุฏ ูุฏููุนุงุช ุนูู ุงูุฅุทูุงู
    }
    return calculatePaidQuantityFromBillRatio(...);
}
```

### 3. ุชุญุณูู ููุทู ุญุณุงุจ ุงูุญุงูุฉ
```javascript
// ูุจู ุงูุฅุตูุงุญ โ
if (this.itemPayments && this.itemPayments.length > 0) {
    // ูุณุชุฎุฏู itemPayments ุญุชู ูู ูุงูุช ูุงุฑุบุฉ
}

// ุจุนุฏ ุงูุฅุตูุงุญ โ
if (this.itemPayments && this.itemPayments.length > 0 && this.paid > 0) {
    // ูุณุชุฎุฏู itemPayments ููุท ุฅุฐุง ูุงู ููุงู ูุฏููุนุงุช ูุนููุฉ
}
```

## ๐ง ุณูุฑูุจุช ุงูุฅุตูุงุญ

ุชู ุฅูุดุงุก ุณูุฑูุจุช `fixItemPaymentsInitialization.js` ูุฅุตูุงุญ ุงูููุงุชูุฑ ุงูููุฌูุฏุฉ:

```bash
cd server
node scripts/fixItemPaymentsInitialization.js
```

### ูุง ููุนูู ุงูุณูุฑูุจุช:
1. ูุฌุฏ ุงูููุงุชูุฑ ุงูุชู ุชุญุชูู ุนูู `itemPayments` ููู `paid = 0`
2. ูุชุญูู ูู ุฃู ุฌููุน `itemPayments` ููุง `paidQuantity = 0`
3. ูุญุฐู `itemPayments` ุงููุงุฑุบุฉ ูู ูุฐู ุงูููุงุชูุฑ
4. ูุญูุธ ุงูุชุบููุฑุงุช

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### ูุจู ุงูุฅุตูุงุญ โ
```
ูุนูููุงุช ุงููุงุชูุฑุฉ:
- ุงููุฏููุน: 0 ุฌ.ู
- ุงููุชุจูู: 470 ุฌ.ู

ุชูุงุตูู ุงูุฃุตูุงู:
- ุดุงู: ุงููุฏููุน = 7ุ ุงููุชุจูู = 0 โ ุฎุทุฃ
- ุดุงูุฑูุง: ุงููุฏููุน = 5ุ ุงููุชุจูู = 0 โ ุฎุทุฃ
```

### ุจุนุฏ ุงูุฅุตูุงุญ โ
```
ูุนูููุงุช ุงููุงุชูุฑุฉ:
- ุงููุฏููุน: 0 ุฌ.ู
- ุงููุชุจูู: 470 ุฌ.ู

ุชูุงุตูู ุงูุฃุตูุงู:
- ุดุงู: ุงููุฏููุน = 0ุ ุงููุชุจูู = 7 โ ุตุญูุญ
- ุดุงูุฑูุง: ุงููุฏููุน = 0ุ ุงููุชุจูู = 5 โ ุตุญูุญ
```

## ๐ฏ ุฎุทูุงุช ุงูุชุทุจูู

### 1. ุชุทุจูู ุงูุฅุตูุงุญุงุช
ุงูุฅุตูุงุญุงุช ูุทุจูุฉ ุจุงููุนู ูู:
- `server/models/Bill.js`
- `src/utils/billAggregation.ts`

### 2. ุชุดุบูู ุณูุฑูุจุช ุงูุฅุตูุงุญ
```bash
cd server
node scripts/fixItemPaymentsInitialization.js
```

### 3. ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
```bash
npm run server:dev
```

### 4. ุงุฎุชุจุงุฑ ุงููุชุงุฆุฌ
- ุงูุชุญ ุงููุงุชูุฑุฉ ุงููุดููุฉ ุนูููุง
- ุชุญูู ูู ุฃู ุงูุฃุฑูุงู ูุชุทุงุจูุฉ ุงูุขู
- ุงุฎุชุจุฑ ุงูุฏูุน ุงูุฌุฒุฆู ููุชุฃูุฏ ูู ุนููู

## โ ุงูุฎูุงุตุฉ

ูุฐุง ุงูุฅุตูุงุญ ูุญู ูุดููุฉ ุงูุชุถุงุฑุจ ูู ุงูุจูุงูุงุช ููุถูู ุฃู:
1. ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ ุชุธูุฑ ุจุดูู ุตุญูุญ (ุฌููุน ุงูุฃุตูุงู ุบูุฑ ูุฏููุนุฉ)
2. ุงูููุงุชูุฑ ุงููุฏููุนุฉ ุฌุฒุฆูุงู ุชุธูุฑ ุงููููุงุช ุงูุตุญูุญุฉ
3. ุงููุธุงู ูุง ููููุฆ `itemPayments` ุฅูุง ุนูุฏ ุงูุญุงุฌุฉ ุงููุนููุฉ