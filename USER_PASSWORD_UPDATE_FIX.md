# ุฅุตูุงุญ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุนูุฏ ุชุนุฏูู ุงููุณุชุฎุฏู

## ๐จ ุงููุดููุฉ
ุนูุฏ ุชุนุฏูู ุงููุณุชุฎุฏู ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏูููุ ูููุฉ ุงููุฑูุฑ ูุง ุชุชุบูุฑ ุญุชู ูู ุชู ุฅุฏุฎุงู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ.

## ๐ ุงูุณุจุจ
ูู ุฏุงูุฉ ุชุญุฏูุซ ุงููุณุชุฎุฏู ูู `server/routes/userRoutes.js`ุ ูู ููู ููุงู ูุนุงูุฌุฉ ูุญูู ูููุฉ ุงููุฑูุฑ.

## โ ุงูุญู ุงููุทุจู

### 1. ุชุญุฏูุซ ุฏุงูุฉ ุชุนุฏูู ุงููุณุชุฎุฏู
**ุงูููู**: `server/routes/userRoutes.js`

#### ูุจู ุงูุฅุตูุงุญ:
```javascript
router.put("/:id", async (req, res) => {
    try {
        const { name, email, role, permissions, status, phone, address } = req.body;
        
        const user = await User.findById(req.params.id);
        
        // Update fields
        if (name) user.name = name;
        if (email) user.email = email;
        // ... ุจุงูู ุงูุญููู
        // โ ูุง ููุฌุฏ ูุนุงูุฌุฉ ููููุฉ ุงููุฑูุฑ
        
        await user.save();
    }
});
```

#### ุจุนุฏ ุงูุฅุตูุงุญ:
```javascript
router.put("/:id", async (req, res) => {
    try {
        const { name, email, role, permissions, status, phone, address, password } = req.body;
        
        const user = await User.findById(req.params.id).select("+password");
        
        // Update fields
        if (name) user.name = name;
        if (email) user.email = email;
        // ... ุจุงูู ุงูุญููู
        
        // โ ูุนุงูุฌุฉ ูููุฉ ุงููุฑูุฑ
        if (password && password.trim() !== '') {
            console.log('Updating password for user:', user.email);
            user.password = password;
            user.markModified('password'); // ุชุฃูุฏ ูู ุฃู Mongoose ูุนุฑู ุฃู ูููุฉ ุงููุฑูุฑ ุชุบูุฑุช
        }
        
        await user.save();
        
        // โ ุฅุฒุงูุฉ ูููุฉ ุงููุฑูุฑ ูู ุงูุงุณุชุฌุงุจุฉ
        const userResponse = user.toObject();
        delete userResponse.password;
        delete userResponse.refreshToken;
    }
});
```

### 2. ุงูุชุญุณููุงุช ุงููุถุงูุฉ

#### ุฃ. ุฌูุจ ูููุฉ ุงููุฑูุฑ:
```javascript
const user = await User.findById(req.params.id).select("+password");
```
- ูุฌูุจ ูููุฉ ุงููุฑูุฑ ุงููุดูุฑุฉ ููููุงุฑูุฉ ูุงูุชุญุฏูุซ

#### ุจ. ูุญุต ูููุฉ ุงููุฑูุฑ:
```javascript
if (password && password.trim() !== '') {
    user.password = password;
    user.markModified('password');
}
```
- ูุชุญูู ูู ูุฌูุฏ ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
- ูุณุชุฎุฏู `markModified()` ูุถูุงู ุญูุธ ุงูุชุบููุฑ

#### ุฌ. ุญูุงูุฉ ุงูุงุณุชุฌุงุจุฉ:
```javascript
const userResponse = user.toObject();
delete userResponse.password;
delete userResponse.refreshToken;
```
- ูุฒูู ูููุฉ ุงููุฑูุฑ ูู ุงูุงุณุชุฌุงุจุฉ ูุฃูุงู ุฅุถุงูู

#### ุฏ. ุชุณุฌูู ุงูุนูููุงุช:
```javascript
console.log('Updating password for user:', user.email);
```
- ูุณุฌู ุนูููุงุช ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ูููุฑุงูุจุฉ

## ๐งช ุงุฎุชุจุงุฑ ุงูุฅุตูุงุญ

### ููู ุงูุงุฎุชุจุงุฑ:
`test-user-edit-password.html`

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ:
1. **ุชุณุฌูู ุฏุฎูู ุงููุฏูุฑ**:
   - ุงูุจุฑูุฏ: `admin@bomba.com`
   - ูููุฉ ุงููุฑูุฑ: `admin123`

2. **ุฌูุจ ูุงุฆูุฉ ุงููุณุชุฎุฏููู**:
   - ุงุถุบุท "ุฌูุจ ูุงุฆูุฉ ุงููุณุชุฎุฏููู"
   - ูุฌุจ ุฃู ุชุธูุฑ ูุงุฆูุฉ ุจุฌููุน ุงููุณุชุฎุฏููู

3. **ุชุนุฏูู ูุณุชุฎุฏู**:
   - ุงุฎุชุฑ ูุณุชุฎุฏู ูู ุงููุงุฆูุฉ
   - ุฃุฏุฎู ูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ
   - ุงุถุบุท "ุชุญุฏูุซ ุงููุณุชุฎุฏู"

4. **ุงุฎุชุจุงุฑ ูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ**:
   - ุงุถุบุท "ุงุฎุชุจุงุฑ ุชุณุฌูู ุงูุฏุฎูู ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ"
   - ูุฌุจ ุฃู ููุฌุญ ุชุณุฌูู ุงูุฏุฎูู

## ๐ฏ ุงููุชุงุฆุฌ ุงููุชููุนุฉ

### โ ุนูุฏ ุชุญุฏูุซ ุงููุณุชุฎุฏู ุจูููุฉ ูุฑูุฑ ุฌุฏูุฏุฉ:
- โ ุชุธูุฑ ุฑุณุงูุฉ "ุชู ุชุญุฏูุซ ุงููุณุชุฎุฏู ุจูุฌุงุญ"
- โ ูููุฉ ุงููุฑูุฑ ุชุชุบูุฑ ูุนููุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูููู ุชุณุฌูู ุงูุฏุฎูู ุจูููุฉ ุงููุฑูุฑ ุงูุฌุฏูุฏุฉ
- โ ูููุฉ ุงููุฑูุฑ ุงููุฏููุฉ ูุง ุชุนูู ุจุนุฏ ุงูุชุญุฏูุซ

### โ ุนูุฏ ุชุญุฏูุซ ุงููุณุชุฎุฏู ุจุฏูู ูููุฉ ูุฑูุฑ:
- โ ุชุธูุฑ ุฑุณุงูุฉ "ุชู ุชุญุฏูุซ ุงููุณุชุฎุฏู ุจูุฌุงุญ"
- โ ูููุฉ ุงููุฑูุฑ ุชุจูู ููุง ูู
- โ ุจุงูู ุงูุจูุงูุงุช ุชุชุญุฏุซ ุจุดูู ุทุจูุนู

## ๐ ุงูุฃูุงู

### ุญูุงูุฉ ูููุฉ ุงููุฑูุฑ:
- โ ูููุฉ ุงููุฑูุฑ ุชูุดูุฑ ุชููุงุฆูุงู ุจูุงุณุทุฉ middleware ูู ุงููููุฐุฌ
- โ ูููุฉ ุงููุฑูุฑ ูุง ุชูุฑุณู ูู ุงูุงุณุชุฌุงุจุฉ
- โ ูุญุต ูุฌูุฏ ูููุฉ ูุฑูุฑ ูุจู ุงูุชุญุฏูุซ
- โ ุชุณุฌูู ุงูุนูููุงุช ูููุฑุงูุจุฉ

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
- โ ูุชุทูุจ ุชุณุฌูู ุงูุฏุฎูู (`protect`)
- โ ูุชุทูุจ ุตูุงุญูุฉ "users" (`authorize`)
- โ ุงููุณุชุฎุฏู ููููู ุชุนุฏูู ูุณุชุฎุฏููู ูู ููุณ ุงูููุธูุฉ ููุท

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุตูุงุญ ูุดููุฉ ุชุญุฏูุซ ูููุฉ ุงููุฑูุฑ ุจูุฌุงุญ:
- โ ูููุฉ ุงููุฑูุฑ ุชุชุญุฏุซ ุนูุฏ ุชุนุฏูู ุงููุณุชุฎุฏู
- โ ุงูุฃูุงู ูุญููุธ ูุน ุงูุชุดููุฑ ุงูุชููุงุฆู
- โ ุงุฎุชุจุงุฑ ุดุงูู ููุชุญูู ูู ุงูุนูููุฉ
- โ ุญูุงูุฉ ูู ุฅุฑุณุงู ูููุงุช ุงููุฑูุฑ ูู ุงูุงุณุชุฌุงุจุงุช

ุงูุขู ูููู ูููุฏูุฑ ุชุนุฏูู ูููุงุช ูุฑูุฑ ุงููุณุชุฎุฏููู ุจูุฌุงุญ ูู ุตูุญุฉ ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู.